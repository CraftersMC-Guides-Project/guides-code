<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <title>Best Reforge Calculator</title>
  <script src="js/script.js" defer></script>
  <script src="js/reforges.js"></script>
    <link rel="stylesheet" href="css/essential.css">
  <style>
  * {
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
  color: #fff;
  overflow-x: hidden;
  background-image: url('Backgrounds/IMG_4500Blurred.webp');
}

body::after {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.7);
  z-index: -1;
}

.container {
  width: 100%;
  height: 100%;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
  color: #007bff;
  width: 100%;
  font-size: 3rem;
}

p {
  text-align: center;
  padding: 20px 0;
  color: white;
  width: 100%;
  margin: 0 auto;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin-bottom: 20px;
}

label {
  font-weight: 600;
  color: #fff;
}

select {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #fff;
  background-color: #0d0d0d;
  color: #fff;
  cursor: pointer;
  transition: all 0.2s;
}

select:disabled, button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

button {
  background-color: #007bff;
  font-weight: 600;
  margin: 8px;
}

#clearStatsBtn {
  background: red;
}

#clearStatsBtn:hover:not(:disabled) {
  background-color: darkred;
  color: #fff;
}

.accordion button {
  margin: 0;
}

.rarity-nav {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-bottom: 15px;
}

.rarity-nav button {
  background-color: #1a1a1a;
  border: 1px solid #007bff;
  color: #007bff;
  font-size: 16px;
  padding: 5px 12px;
  border-radius: 6px;
}

.rarity-nav button:hover:not(:disabled) {
  background-color: #007bff;
  color: #fff;
}

.rarity-nav span {
  margin: 0 15px;
  font-weight: bold;
  color: #fff;
}

table {
  width: 100%;
  max-width: 100%;
  table-layout: fixed;
  word-wrap: break-word;
  border-collapse: collapse;
  margin-top: 10px;
  user-select: none;
}

th, td {
  padding: 12px 8px;
  text-align: center;
  border-bottom: 1px solid #333;
}

thead th {
  background-color: #007bff;
  font-weight: 600;
  color: #fff;
}

tbody tr:hover {
  background-color: #222;
}

tbody tr:nth-child(1) td {
  background-color: #ffd700;
  font-weight: bold;
  color: #000;
}

tbody tr:nth-child(2) td {
  background-color: #c0c0c0;
  font-weight: bold;
  color: #000;
}

tbody tr:nth-child(3) td {
  background-color: #cd7f32;
  font-weight: bold;
  color: #000;
}

.reforge-name-wrapper {
  display: inline-block;
  position: relative;
}

.info-icon {
  position: absolute;
  top: -5px;
  right: -11px;
  background-color: #888;
  color: #fff;
  border-radius: 50%;
  width: 10px;
  height: 10px;
  font-size: 9px;
  line-height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: default;
  opacity: 0.8;
  z-index: 9;
  user-select: none;
}

.info-popup {
  display: none;
  position: absolute;
  top: -5px;
  left: 210%;
  background-color: #1a1a1a;
  color: #fff;
  padding: 6px;
  border: 1px solid #888;
  border-radius: 6px;
  font-size: 0.8rem;
  white-space: nowrap;
  z-index: 10;
}

.info-icon:hover .info-popup {
  display: block;
}

.checkbox-container {
  display: block;
  gap: 6px;
  margin-top: 4px;
}

.checkbox-group {
  display: flex;
  flex-direction: row;
  gap: 6px;
  align-items: center;
}

.checkbox-group input[type="checkbox"] {
  accent-color: #007bff;
  cursor: pointer;
  transform: scale(1.05);
  margin-right: 6px;
}

#statCheckboxes.checkbox-group {
  display: block !important;
}

.checkbox-group label {
  cursor: pointer;
  user-select: none;
  font-weight: 500;
  color: #fff;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

.checkbox-group input[type="checkbox"]:hover + label,
.checkbox-group label:hover {
  color: #007bff;
}

.checkbox-group input[type="checkbox"]:disabled + label {
  opacity: 0.4;
  cursor: not-allowed;
}

.header-info {
  display: inline-block;
  position: relative;
}

.header-info .info-icon {
  position: relative;
  top: -2px;
  right: -2px;
  background-color: #888;
  color: #fff;
  border-radius: 50%;
  width: 12px;
  height: 12px;
  font-size: 10px;
  line-height: 12px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: default;
  opacity: 0.8;
  margin-left: 4px;
}

.header-info .info-popup {
  display: none;
  position: absolute;
  top: -120%;
  left: 50%;
  transform: translateX(-50%);
  background-color: #1a1a1a;
  color: #fff;
  padding: 6px;
  border: 1px solid #888;
  border-radius: 6px;
  font-size: 0.8rem;
  white-space: nowrap;
  z-index: 20;
}

.header-info .info-icon:hover .info-popup {
  display: block;
}

.accordion {
  margin: 15px 0;
  border: 1px solid #333;
  border-radius: 8px;
  overflow: hidden;
}

.accordion-toggle {
  width: 100%;
  text-align: left;
  padding: 10px 14px;
  background-color: #1a1a1a;
  color: #fff;
  font-weight: 600;
  border: none;
  outline: none;
  cursor: pointer;
  transition: background-color 0.2s;
}

.accordion-toggle:hover {
  background-color: #2a2a2a;
}

.accordion-content {
  display: none;
  padding: 10px 14px;
  background-color: #111;
}

.pref-mode {
  margin: 6px 0;
}

.pref-mode input[type="radio"] {
  accent-color: #007bff;
  cursor: pointer;
}

.pref-mode label {
  margin-left: 6px;
  cursor: pointer;
}

.accordion-icon {
  transition: transform 0.2s ease;
  margin-left: auto;
}

.accordion-header.active .accordion-icon {
  transform: rotate(180deg);
}

tbody tr:nth-child(1) td:last-child,
tbody tr:nth-child(2) td:last-child,
tbody tr:nth-child(3) td:last-child {
  text-shadow:
    0.5px 0.5px black,
    -0.5px -0.5px black,
    0.5px -0.5px black,
    -0.5px 0.5px black;
}
</style>
</head>
<body>
    <div class="top"></div>
  <div class="sidebar" id="sidebar"></div>
  <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
  <div class="gap"></div>
  <div style="margin-bottom:50px;"></div>
  <h1>Best Reforge Calculator</h1>
  <p>This calculator can sort out stats from highest to lowest. Select the item and stat you want on the item, and click on the calculate button. Use the ‚Üê and ‚Üí arrows to select the rarity of item!</p>
  <div class="container">
    <div class="controls">
      <label for="item">Choose Item:</label>
<div class="controls">
  <label>Choose Item(s):</label>
<select id="item">
  <option value="" disabled selected hidden>Select an item</option>
  <option value="Sword">Sword</option>
  <option value="Armor">Armor</option>
  <option value="Axe">Axe</option>
  <option value="Hoe">Hoe</option>
  <option value="Accessory">Accessory</option>
  <option value="Bow">Bow</option>
  <option value="Boomerang">Boomerang</option>
</select>

<label style="width:100%;">Choose Stat(s):</label>
<div class="checkbox-container"><div class="checkbox-group" id="statCheckboxes"></div>
<button id="clearStatsBtn">Clear Stats</button>
<button id="calculateBtn" disabled>Calculate</button>
</div></div>
<div class="accordion-wrapper" style="position: relative; margin: 15px 0;">
  <span class="info-icon" style="position: absolute; top: 2px; right: -8px; z-index: 100;">?
    <div class="info-popup">
      Choose how reforges are ranked:<br>
      - Balanced: All selected stats are ranked equally on leaderboard.<br>
      - Focused: Prioritizes a single stat if multiple stats are selected.
    </div>
  </span>
  <div class="accordion">
    <button class="accordion-toggle">
      Preferred Stat Mode
      <span class="material-icons accordion-icon">expand_more</span>
    </button>
    <div class="accordion-content">
      <div class="pref-mode">
        <input type="radio" id="pref_balanced" name="prefMode" value="balanced" checked>
        <label for="pref_balanced">Balanced</label>
      </div>
    </div>
  </div>
</div>
<div class="rarity-nav">
  <button id="prevRarity"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="m22.35 38.95-13.9-13.9q-.25-.25-.35-.5Q8 24.3 8 24q0-.3.1-.55.1-.25.35-.5L22.4 9q.4-.4 1-.4t1.05.45q.45.45.45 1.05 0 .6-.45 1.05L13.1 22.5h24.8q.65 0 1.075.425.425.425.425 1.075 0 .65-.425 1.075-.425.425-1.075.425H13.1l11.4 11.4q.4.4.4 1t-.45 1.05q-.45.45-1.05.45-.6 0-1.05-.45Z"/></svg></button>
  <span id="currentRarity"></span>
  <button id="nextRarity"><svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" height="1.5em" width="1.5em"><path fill="currentColor" d="M22.95 38.9q-.4-.4-.4-1.05t.4-1.05l11.3-11.3H9.5q-.65 0-1.075-.425Q8 24.65 8 24q0-.65.425-1.075Q8.85 22.5 9.5 22.5h24.75l-11.3-11.3q-.4-.4-.4-1.075 0-.675.4-1.075.4-.4 1.05-.4t1.05.4l13.9 13.9q.25.25.35.5.1.25.1.55 0 .25-.1.525t-.35.525l-13.9 13.9q-.4.4-1.05.375-.65-.025-1.05-.425Z"/></svg></button>
</div>

<table id="resultsTable">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Reforge</th>
      <th id="statHeader">Stat</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>
</div>
    <div class="index-footer">
    <div id="footer"></div><script>
const rarities = ["Common", "Uncommon", "Rare", "Epic", "Legendary", "Special"];
let currentRarityIndex = 0;
const itemSelect = document.getElementById("item");
itemSelect.addEventListener("change", updateStatOptions);
const statCheckboxesDiv = document.getElementById("statCheckboxes");
const calcBtn = document.getElementById("calculateBtn");
const resultsTable = document.querySelector("#resultsTable tbody");
const clearStatsBtn = document.getElementById("clearStatsBtn");
clearStatsBtn.addEventListener("click", () => {
  statCheckboxesDiv.querySelectorAll("input[type='checkbox']").forEach(cb => cb.checked = false);
  updateDisabledStats();
  updateCalculateButton();
  updatePreferredModes();
});
const prevRarityBtn = document.getElementById("prevRarity");
const nextRarityBtn = document.getElementById("nextRarity");
const currentRarityLabel = document.getElementById("currentRarity");
const accordionToggle = document.querySelector(".accordion-toggle");
const accordionContent = document.querySelector(".accordion-content");
const accordionIcon = accordionToggle.querySelector(".accordion-icon");

accordionToggle.addEventListener("click", () => {
  const isVisible = accordionContent.style.display === "block";
  accordionContent.style.display = isVisible ? "none" : "block";
  accordionToggle.classList.toggle("active");
  accordionIcon.textContent = isVisible ? "expand_more" : "expand_less";
});
calcBtn.addEventListener("click", () => renderTable(rarities[currentRarityIndex]));
prevRarityBtn.addEventListener("click", () => {
  if (currentRarityIndex > 0) {
    currentRarityIndex--;
    updateRarity();
  }
});
nextRarityBtn.addEventListener("click", () => {
  if (currentRarityIndex < rarities.length - 1) {
    currentRarityIndex++;
    updateRarity();
  }
});

function updateRarity() {
  currentRarityLabel.textContent = rarities[currentRarityIndex];
  renderTable(rarities[currentRarityIndex]);
  prevRarityBtn.disabled = currentRarityIndex === 0;
  nextRarityBtn.disabled = currentRarityIndex === rarities.length - 1;
}

function updateStatOptions() {
  const selectedItem = itemSelect.value;
  if (!selectedItem) {
    calcBtn.disabled = true;
    statCheckboxesDiv.innerHTML = "";
    return;
  }

  const statSet = new Set();
  reforges.forEach(r => {
    if (r.itemTypes.includes(selectedItem)) {
      rarities.forEach(rarity => {
        Object.keys(r.stats[rarity] || {}).forEach(stat => statSet.add(stat));
      });
    }
  });

  statCheckboxesDiv.innerHTML = "";

  Array.from(statSet).sort().forEach(stat => {
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.id = "stat_" + stat;
    cb.value = stat;

    const label = document.createElement("label");
    label.htmlFor = cb.id;
    label.textContent = stat;

    cb.addEventListener("change", () => {
      updateCalculateButton();
      updateDisabledStats();
      updatePreferredModes();
    });

    const wrapper = document.createElement("div");
    wrapper.classList.add("checkbox-group");
    wrapper.appendChild(cb);
    wrapper.appendChild(label);

    statCheckboxesDiv.appendChild(wrapper);
  });

  updateDisabledStats();
  updateCalculateButton();
  updatePreferredModes();
}

function updatePreferredModes() {
  const prefContent = document.querySelector(".accordion-content");
  prefContent.querySelectorAll(".pref-mode.focused").forEach(el => el.remove());
  const selectedStats = Array.from(statCheckboxesDiv.querySelectorAll("input[type='checkbox']:checked")).map(cb => cb.value);

  if (selectedStats.length > 1) {
    selectedStats.forEach(stat => {
      const radio = document.createElement("input");
      radio.type = "radio";
      radio.id = "pref_focus_" + stat;
      radio.name = "prefMode";
      radio.value = stat + "_focused";
      const label = document.createElement("label");
      label.htmlFor = radio.id;
      label.textContent = `${stat} Focused`;
      const wrapper = document.createElement("div");
      wrapper.classList.add("pref-mode", "focused");
      wrapper.appendChild(radio);
      wrapper.appendChild(label);
      prefContent.appendChild(wrapper);
    });
  }

  const radios = prefContent.querySelectorAll("input[name='prefMode']");
  const anyChecked = Array.from(radios).some(r => r.checked);
  if (!anyChecked && radios.length > 0) {
    radios[0].checked = true;
  }
}

function updateDisabledStats() {
  const selectedItem = itemSelect.value;
  const selectedStats = Array.from(statCheckboxesDiv.querySelectorAll("input[type='checkbox']:checked")).map(cb => cb.value);
  statCheckboxesDiv.querySelectorAll("input[type='checkbox']").forEach(cb => {
    const hypothetical = selectedStats.includes(cb.value) ? selectedStats : [...selectedStats, cb.value];
    const anyValid = reforges.some(r => 
      r.itemTypes.includes(selectedItem) &&
      hypothetical.every(stat => Object.values(r.stats).some(statsByRarity => statsByRarity[stat] !== undefined))
    );
    cb.disabled = !anyValid;
  });
}

function updateCalculateButton() {
  const selectedStats = Array.from(statCheckboxesDiv.querySelectorAll("input[type='checkbox']:checked"));
  const selectedItem = itemSelect.value;
  calcBtn.disabled = !selectedItem || selectedStats.length === 0;
}

function toggleInfo(el) {
  const popup = el.nextElementSibling;
  popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
}

function renderTable(rarity) {
  const selectedItem = itemSelect.value;
  const selectedStats = Array.from(
    statCheckboxesDiv.querySelectorAll("input[type='checkbox']:checked")
  ).map(cb => cb.value);

  if (!selectedItem || selectedStats.length === 0) return;

  const prefMode = document.querySelector('input[name="prefMode"]:checked')?.value || "balanced";
  const statHeader = document.getElementById("statHeader");

  if (selectedStats.length === 1) {
    statHeader.textContent = selectedStats[0];
  } else if (selectedStats.length > 1) {
    statHeader.innerHTML = `
      <span class="header-info">
        Stats <span class="info-icon">ùöí
          <div class="info-popup"><b>Selected Stats</b><br><hr>${selectedStats.join("<br>")}</div>
        </span>
      </span>`;
  } else {
    statHeader.textContent = "Stat";
  }

  const validReforges = reforges.filter(r => r.itemTypes.includes(selectedItem));
  const filtered = validReforges.filter(r =>
    selectedStats.every(stat => (r.stats[rarity] || {})[stat] !== undefined)
  );

  const ranked = [...filtered].sort((a, b) => {
    if (prefMode === "balanced") {
      const weight = 1 / selectedStats.length;
      const scoreA = selectedStats.reduce(
        (acc, s) => acc + ((a.stats[rarity]?.[s] || 0) * weight), 0
      );
      const scoreB = selectedStats.reduce(
        (acc, s) => acc + ((b.stats[rarity]?.[s] || 0) * weight), 0
      );
      return scoreB - scoreA;
    } else {
      const focusedStat = prefMode.replace("_focused", "");
      const scoreA = a.stats[rarity]?.[focusedStat] || 0;
      const scoreB = b.stats[rarity]?.[focusedStat] || 0;
      return scoreB - scoreA;
    }
  });

  resultsTable.innerHTML = "";

  ranked.forEach((reforge, i) => {
    const allStats = reforge.stats[rarity] || {};

    // Colorize stats in popup
    const statsList = Object.entries(allStats)
      .map(([key, value]) => {
        const color = statColors[key] || "#fff";
        return `<span style="color:${color}">${key}: ${value}</span>`;
      })
      .join("<br>");

    // Colorize cell values
    let cellValue;
    if (selectedStats.length === 1) {
      const stat = selectedStats[0];
      const color = statColors[stat] || "#fff";
      cellValue = `<span style="color:${color}">${reforge.stats[rarity]?.[stat] || "-"}</span>`;
    } else {
      cellValue = selectedStats
        .map(s => {
          const color = statColors[s] || "#fff";
          return `<span style="color:${color}">${reforge.stats[rarity]?.[s] || 0}</span>`;
        })
        .join(" / ");
    }

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>
        <div class="reforge-name-wrapper">
          ${reforge.name}
          <span class="info-icon">ùöí
            <div class="info-popup"><b>All Stats</b><br><hr>${statsList}</div>
          </span>
        </div>
      </td>
      <td>${cellValue}</td>
    `;
    resultsTable.appendChild(row);
  });
}

updateRarity();
</script></body>
</html>
