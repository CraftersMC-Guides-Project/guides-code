<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minion production</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <script src="../js/script.js"></script>
  <link rel="stylesheet" href="../css/essential.css"/>
  <link rel="stylesheet" href="../css/tools.css"/>
  <style>
/*keep these here cos they are minion prod specific, no point in unfication with tools.css - tech <3

btw why do we have this?*/
#note {
  text-align: center;
  margin-bottom: 16px;
  color: #0056b3;
}

.minion-prod-lable2 {
  display: block;
  margin: 16px 0 6px 0;
  font-weight: bold;
  color: #fff;
}

.minion-prod-input {
  display: flex;
  align-items: first baseline;
  gap: 8px;
  margin-bottom: 12px;
}

button {
  padding: 4px 12px;
  font-size: 1.2rem;
}

#rarity {
  width: 40px;
  text-align: center;
  background: transparent;
  color: #fff;
  border: 2px solid #fff;
  border-radius: 6px;
  font-size: 1.2rem;
  padding: 4px 12px;
}

.minion-prod-fuel-options {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 16px;
}

.minion-prod-mc-radio {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.98rem;
}

#minion-prod-result {
  display: block;
  margin: 18px auto 10px auto;
  align-self: center;
  border-radius: 8px;
  padding: 12px 24px;
}


#resultText, #npcPrice, #exp, #second {
  margin: 10px 0;
  font-size: 1rem;
  color: #ffe16b;
}
  </style>
</head>




<body>
  <div id="loader">
    <div></div>
    <div></div>
    <div></div>
  </div>

  <div class="minion-prod-background"></div>
  <div class="top"></div>
  <div class="sidebar" id="sidebar"></div>
  <div id="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="gap"></div>
  <div class="container">
    <h3>Minion Production Calculator</h3>
    <div id="note">
      <span id="note">Note: <em>All the production are as per 24 hours concept.</em></span>
    </div>
    <label class="minion-prod-lable2">Minion:</label>
    <select id="input2">
      <optgroup class="minion-prod-optgroup" label="Farming">
        <option class="minion-prod-option" value="Beetroot Minion">Beetroot Minion</option>
        <option class="minion-prod-option" value="Cactus Minion">Cactus Minion</option>
        <option class="minion-prod-option" value="Carrot Minion">Carrot Minion</option>
        <option class="minion-prod-option" value="Chicken Minion">Chicken Minion</option>
        <option class="minion-prod-option" value="Cocoa Beans Minion">Cocoa Beans Minion</option>
        <option class="minion-prod-option" value="Cow Minion">Cow Minion</option>
        <option class="minion-prod-option" value="Duck Minion">Duck Minion</option>
        <option class="minion-prod-option" value="Melon Minion">Melon Minion</option>
        <option class="minion-prod-option" value="Mushroom Minion">Mushroom Minion</option>
        <option class="minion-prod-option" value="Pig Minion">Pig Minion</option>
        <option class="minion-prod-option" value="Potato Minion">Potato Minion</option>
        <option class="minion-prod-option" value="Pumpkin Minion">Pumpkin Minion</option>
        <option class="minion-prod-option" value="Rabbit Minion">Rabbit Minion</option>
        <option class="minion-prod-option" value="Sheep Minion">Sheep Minion</option>
        <option class="minion-prod-option" value="Sugar Cane Minion">Sugar Cane Minion</option>
        <option class="minion-prod-option" value="Wheat Minion">Wheat Minion</option>
      </optgroup>
      <optgroup class="minion-prod-optgroup" label="Combat">
        <option class="minion-prod-option" value="Blaze Minion">Blaze Minion</option>
        <option class="minion-prod-option" value="Cave Spider Minion">Cave Spider Minion</option>
        <option class="minion-prod-option" value="Creeper Minion">Creeper Minion</option>
        <option class="minion-prod-option" value="Magma Cube Minion">Magma Cube Minion</option>
        <option class="minion-prod-option" value="Revenant Minion">Revenant Minion</option>
        <option class="minion-prod-option" value="Skeleton Minion">Skeleton Minion</option>
        <option class="minion-prod-option" value="Slime Minion">Slime Minion</option>
        <option class="minion-prod-option" value="Spider Minion">Spider Minion</option>
        <option class="minion-prod-option" value="Zombie Minion">Zombie Minion</option>
      </optgroup>
      <optgroup class="minion-prod-optgroup" label="Mining">
        <option class="minion-prod-option" value="Cobblestone Minion">Cobblestone Minion</option>
        <option class="minion-prod-option" value="Coal Minion">Coal Minion</option>
        <option class="minion-prod-option" value="Diamond Minion">Diamond Minion</option>
        <option class="minion-prod-option" value="Emerald Minion">Emerald Minion</option>
        <option class="minion-prod-option" value="Gold Minion">Gold Minion</option>
        <option class="minion-prod-option" value="Ice Minion">Ice Minion</option>
        <option class="minion-prod-option" value="Iron Minion">Iron Minion</option>
        <option class="minion-prod-option" value="Lapis Lazuli Minion">Lapis Lazuli Minion</option>
        <option class="minion-prod-option" value="Obsidian Minion">Obsidian Minion</option>
        <option class="minion-prod-option" value="Redstone Minion">Redstone Minion</option>
      </optgroup>
      <optgroup class="minion-prod-optgroup" label="Foraging">
        <option class="minion-prod-option" value="Acacia Log Minion">Acacia Log Minion</option>
        <option class="minion-prod-option" value="Birch Log Minion">Birch Log Minion</option>
        <option class="minion-prod-option" value="Dark Oak Log Minion">Dark Oak Log Minion</option>
        <option class="minion-prod-option" value="Jungle Log Minion">Jungle Log Minion</option>
        <option class="minion-prod-option" value="Oak Log Minion">Oak Log Minion</option>
        <option class="minion-prod-option" value="Spruce Log Minion">Spruce Log Minion</option>
      </optgroup>
    </select>
    <label class="minion-prod-lable2">Tier:</label>
    <div class="minion-prod-input">
      <button class="minion-prod-ibtn" id="previous">&lt;</button>
      <input id="rarity" type="text" readonly value="1" />
      <button class="minion-prod-ibtn" id="after">&gt;</button>
    </div>
    <label class="minion-prod-lable2">Fuel:</label>
    <div class="minion-prod-fuel-options">
      <label class="minion-prod-mc-radio">
        <input type="radio" name="fuel" value="foul" id="bread" />
        <span>Enchanted bread</span>
      </label>
      <label class="minion-prod-mc-radio">
        <input type="radio" name="fuel" value="lava" id="lava" />
        <span>Enchanted Lava Bucket</span>
      </label>
      <label class="minion-prod-mc-radio">
        <input type="radio" name="fuel" value="hamster" id="wheel" />
        <span>Hamster Wheel</span>
      </label>
      <label class="minion-prod-mc-radio">
        <input type="radio" name="fuel" value="foul" id="foul" />
        <span>Foul Flesh</span>
      </label>
    </div>
    <label class="minion-prod-lable2">Upgrades:</label>
    <label class="minion-prod-mc-radio">
      <input type="radio" name="diamond" value="diamond" id="diamond" />
      <span>Diamond Spreading</span>
    </label>
    <button id="minion-prod-result">Get Results</button>
    <div id="resultText"></div>
    <div id="npcPrice"></div>
    <div id="exp"></div>
    <div id="second"></div>
  </div>
  
  <script>
    let rarity = document.getElementById("rarity");
    let previous = document.getElementById("previous");
    let after = document.getElementById("after");

    // Handle rarity switching
    previous.onclick = function () {
      let level = parseInt(rarity.value);
      rarity.value = level === 1 ? "11" : level - 1;
    };

    after.onclick = function () {
      let level = parseInt(rarity.value);
      rarity.value = level === 11 ? "1" : level + 1;
    };

    let sdata = [];

    // Load minion data
    fetch("../skill-exp/minion-production.json")
      .then((res) => res.json())
      .then((data) => {
        sdata = data;
      });

    // Load market prices
    async function loadMinionPrices() {
      try {
        let txt = await fetch("../market/mprices.txt").then((res) => res.text());
        return txt
          .split("\n")
          .map((line) => {
            try {
              return JSON.parse(line.split(": ")[1]);
            } catch {
              return null;
            }
          })
          .filter(Boolean);
      } catch (e) {
        console.error("Error loading prices:", e);
        document.getElementById("resultText").textContent =
          "Error loading market prices!";
        document.getElementById("second").style.display = "none";
        document.getElementById("npcPrice").style.display = "none";
        document.getElementById("exp").style.display = "none";
        return null;
      }
    }

    document.getElementById("minion-prod-result").onclick = async () => {
      const name = document.getElementById("input2").value.trim();
      const tierIndex = parseInt(rarity.value) - 1;

      const minion = sdata.find((m) => m.name === name);
      if (!minion) {
        document.getElementById("resultText").textContent = "Name not found!";
        document.getElementById("second").style.display = "none";
        document.getElementById("npcPrice").style.display = "none";
        document.getElementById("exp").style.display = "none";
        return;
      }

      const tier = minion.tiers[tierIndex];
      if (!tier) {
        document.getElementById("resultText").textContent =
          "Tier data not available!";
        document.getElementById("second").style.display = "none";
        document.getElementById("npcPrice").style.display = "none";
        document.getElementById("exp").style.display = "none";
        return;
      }

      const prices = await loadMinionPrices();
      if (!prices) return;

      const secondsPerDay = 60 * 60 * 24;
      const time = tier.time;
      let totalCoins = 0;
      let outputText = [];
      let npcOut = 0;

      let p1 = 0,
        p2 = 0,
        p3 = 0;

      // Handle chance1
      if (minion.id && tier.chance1 > 0) {
        const price = prices[minion.id - 1]?.[1];
        if (price !== undefined) {
          p1 = (tier.chance1 * secondsPerDay) / (time * 2) / 160;
          if (document.getElementById("lava").checked) p1 = p1 + p1 * 0.25;
          else if (document.getElementById("bread").checked)
            p1 = p1 + p1 * (5 / 100);
          else if (document.getElementById("wheel").checked)
            p1 = p1 + p1 * (40 / 100);
          else if (document.getElementById("foul").checked)
            p1 = p1 + p1 * (80 / 100);
          totalCoins += p1 * price;
          outputText.push(
            `${Math.round(p1)}x of ${prices[minion.id - 1]?.[0]}`
          );
          npcOut += prices[minion.id - 1]?.[2] * p1;
        }
      }

      // Handle chance2
      if (minion.id2 && minion.id2 > 0 && tier.chance2 > 0) {
        const price = prices[minion.id2 - 1]?.[1];
        if (price !== undefined) {
          p2 = (tier.chance2 * secondsPerDay) / (time * 2) / 160;
          if (document.getElementById("lava").checked) p2 = p2 + p2 * 0.25;
          else if (document.getElementById("bread").checked)
            p2 = p2 + p2 * (5 / 100);
          else if (document.getElementById("wheel").checked)
            p2 = p2 + p2 * (40 / 100);
          else if (document.getElementById("foul").checked)
            p2 = p2 + p2 * (80 / 100);
          totalCoins += p2 * price;
          outputText.push(
            `${Math.round(p2)}x of ${prices[minion.id2 - 1]?.[0]}`
          );
          npcOut += prices[minion.id2 - 1]?.[2] * p2;
        }
      }

      // Handle chance3
      if (minion.id3 && minion.id3 > 0 && tier.chance3 > 0) {
        const price = prices[minion.id3 - 1]?.[1];
        if (price !== undefined) {
          p3 = (tier.chance3 * secondsPerDay) / (time * 2) / 160;
          if (document.getElementById("lava").checked) p3 = p3 + p3 * 0.25;
          else if (document.getElementById("bread").checked)
            p3 = p3 + p3 * (5 / 100);
          else if (document.getElementById("wheel").checked)
            p3 = p3 + p3 * (40 / 100);
          else if (document.getElementById("foul").checked)
            p3 = p3 + p3 * (80 / 100);
          totalCoins += p3 * price;
          outputText.push(
            `${Math.round(p3)}x of ${prices[minion.id3 - 1]?.[0]}`
          );
          npcOut += prices[minion.id3 - 1]?.[2] * p3;
        }
      }

      // EXP calculation
      let totalExp = 0;
      let expOut = [];
      let e = 10;

      if (minion.exp1) {
        totalExp += p1 * minion.exp1;
        if (p1 > 0)
          expOut.push(
            `${(p1 * minion.exp1).toFixed(2)} EXP from ${prices[minion.id - 1]?.[0]
            }`
          );
      }

      if (minion.exp2) {
        totalExp += p2 * minion.exp2;
        if (p2 > 0)
          expOut.push(
            `${(p2 * minion.exp2).toFixed(2)} EXP from ${prices[minion.id2 - 1]?.[0]
            }`
          );
      }

      if (minion.exp3 && minion.exp3 > 0) {
        totalExp += p3 * minion.exp3;
        if (p3 > 0)
          expOut.push(
            `${(p3 * minion.exp3).toFixed(2)} EXP from ${prices[minion.id3 - 1]?.[0]
            }`
          );
      }
      let totalP = 0;
      if (document.getElementById("diamond").checked) {
        totalP = p1 + p1 + p3;
        totalCoins =
          totalCoins + (totalP / 10) * prices[sdata[0].diamond - 1]?.[1];
        npcOut = npcOut + (totalP / 10) * prices[sdata[0].diamond - 1]?.[2];
        expOut.push(
          `${Math.round((totalP / 10) * e)} Exp from Enchanted Diamond`
        );
        outputText.push(`${Math.round(totalP / 10)}x of Enchanted Diamond`);
        totalExp = totalExp + (totalP / 10) * e;
      }
      // Show result
      document.getElementById(
        "resultText"
      ).textContent = `Approximate market sell profit*: ${Math.round(
        totalCoins
      )} coins.`;

      document.getElementById("npcPrice").style.display = "block";
      document.getElementById(
        "npcPrice"
      ).textContent = `NPC sell profit: ${Math.round(npcOut)} coins.`;

      document.getElementById("second").style.display = "block";
      document.getElementById(
        "second"
      ).textContent = `Total minion production: ${outputText.join(" and ")}.`;

      document.getElementById("exp").style.display = "block";
      document.getElementById(
        "exp"
      ).textContent = `Total EXP gained: ${totalExp.toFixed(
        2
      )} (${expOut.join(" + ")}).`;
    };
  </script>

  <p>
    * market profit values are approximate and are not exact. But provides a
    general conclusion of the rough amount you will get.
  </p>
  <div id="footer"></div>
</body>

</html>
