<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skyblock Trade Calculator</title>
    <style>
        body {
            font-family: 'Minecraft', Arial, sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #ffaa00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .calculator {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .trade-side {
            flex: 1;
            background-color: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            margin: 0 10px 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-width: 300px;
        }

        .seller-side {
            border: 2px solid #55ff55;
        }

        .buyer-side {
            border: 2px solid #ff5555;
        }

        .result-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 200px;
            margin: 0 10px 20px;
        }

        .result-box {
            background-color: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
        }

        .coins-input {
            margin-bottom: 15px;
        }

        .coins-input label {
            display: block;
            margin-bottom: 5px;
        }

        .coins-input input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #222;
            color: #fff;
        }

        .items-container {
            min-height: 400px;
            border: 1px dashed #555;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .item-slot {
            display: flex;
            align-items: center;
            background-color: #3a3a3a;
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 4px;
            position: relative;
        }

        .item-slot img {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            image-rendering: pixelated;
        }

        .item-details {
            flex: 1;
        }

        .item-name {
            font-weight: bold;
        }

        .item-price {
            color: #ffaa00;
        }

        .remove-item {
            background: none;
            border: none;
            color: #ff5555;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
        }

        .add-item-btn {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .add-item-btn:hover {
            background-color: #45a049;
        }

        .calculate-btn {
            padding: 10px 20px;
            background-color: #ffaa00;
            color: #000;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }

        .calculate-btn:hover {
            background-color: #e69500;
        }

        .total-value {
            text-align: right;
            margin-top: 10px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
        }

        .modal-content {
            background-color: #2d2d2d;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #555;
            width: 90%;
            max-width: 800px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #fff;
        }

        .search-box {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .search-box input, .search-box select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #222;
            color: #fff;
            min-width: 150px;
        }

        .search-box input {
            flex: 1;
        }

        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .item-option {
            background-color: #3a3a3a;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .item-option:hover {
            background-color: #4a4a4a;
        }

        .item-option img {
            width: 32px;
            height: 32px;
            margin-right: 10px;
            image-rendering: pixelated;
        }

        .item-option span {
            flex: 1;
        }

        /* Rarity colors */
        .common {
            color: #ffffff;
        }
        .uncommon {
            color: #55ff55;
        }
        .rare {
            color: #5555ff;
        }
        .epic {
            color: #aa00aa;
        }
        .legendary {
            color: #ffaa00;
        }

        /* Profit/Loss colors */
        .profit {
            color: #55ff55;
        }

        .loss {
            color: #ff5555;
        }

        .neutral {
            color: #aaaaaa;
        }

        @media (max-width: 768px) {
            .calculator {
                flex-direction: column;
            }
            
            .trade-side, .result-section {
                width: 100%;
                margin: 0 0 20px 0;
            }
            
            .item-list {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Skyblock Trade Calculator</h1>
        
        <div class="calculator">
            <div class="trade-side seller-side">
                <h2>Seller (You)</h2>
                <div class="coins-input">
                    <label for="seller-coins">Coins:</label>
                    <input type="number" id="seller-coins" min="0" value="0">
                </div>
                <div class="items-container" id="seller-items">
                    <!-- Seller items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addItem('seller')">+ Add Item</button>
                <div class="total-value">
                    <h3>Total Value: <span id="seller-total">0</span> coins</h3>
                </div>
            </div>
            
            <div class="result-section">
                <div class="result-box" id="result">
                    <h3>Trade Result</h3>
                    <p>Add items to calculate</p>
                </div>
                <button class="calculate-btn" onclick="calculateTrade()">Calculate Trade</button>
            </div>
            
            <div class="trade-side buyer-side">
                <h2>Buyer (Them)</h2>
                <div class="coins-input">
                    <label for="buyer-coins">Coins:</label>
                    <input type="number" id="buyer-coins" min="0" value="0">
                </div>
                <div class="items-container" id="buyer-items">
                    <!-- Buyer items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addItem('buyer')">+ Add Item</button>
                <div class="total-value">
                    <h3>Total Value: <span id="buyer-total">0</span> coins</h3>
                </div>
            </div>
        </div>
        
        <!-- Item selection modal -->
        <div class="modal" id="item-modal">
            <div class="modal-content">
                <span class="close-btn" onclick="closeModal()">&times;</span>
                <h3>Select Item</h3>
                <div class="search-box">
                    <input type="text" id="item-search" placeholder="Search items..." oninput="searchItems()">
                    <select id="item-category" onchange="filterItems()">
                        <option value="all">All Categories</option>
                        <option value="combat">Combat</option>
                        <option value="farming">Farming</option>
                        <option value="mining">Mining</option>
                        <option value="foraging">Foraging</option>
                        <option value="fishing">Fishing</option>
                    </select>
                    <select id="item-rarity" onchange="filterItems()">
                        <option value="all">All Rarities</option>
                        <option value="common">Common</option>
                        <option value="uncommon">Uncommon</option>
                        <option value="rare">Rare</option>
                        <option value="epic">Epic</option>
                        <option value="legendary">Legendary</option>
                    </select>
                </div>
                <div class="item-list" id="item-list">
                    <!-- Items will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentSide = 'seller'; // Track which side we're adding items to
        let marketItems = [];
        let minionPricesData = [];
        let petPricesData = [];

        // DOM elements
        const sellerItemsContainer = document.getElementById('seller-items');
        const buyerItemsContainer = document.getElementById('buyer-items');
        const sellerTotalElement = document.getElementById('seller-total');
        const buyerTotalElement = document.getElementById('buyer-total');
        const sellerCoinsInput = document.getElementById('seller-coins');
        const buyerCoinsInput = document.getElementById('buyer-coins');
        const resultElement = document.getElementById('result');
        const itemModal = document.getElementById('item-modal');
        const itemListElement = document.getElementById('item-list');
        const itemSearchInput = document.getElementById('item-search');
        const itemCategorySelect = document.getElementById('item-category');
        const itemRaritySelect = document.getElementById('item-rarity');

        // Initialize the calculator
        document.addEventListener('DOMContentLoaded', function() {
            // Load all data
            loadData();
            
            // Set up event listeners
            sellerCoinsInput.addEventListener('input', updateTotals);
            buyerCoinsInput.addEventListener('input', updateTotals);
        });

        // Load all data
        function loadData() {
            // Sample market data (replace with your actual market.txt content)
            marketItems = [
                {
                    "id": "1",
                    "name": "Enchanted Rotten Flesh",
                    "picture": "img/Enchanted_Rotten_Flesh.png",
                    "rarity": "uncommon",
                    "price": "720",
                    "description": "Crafted from 2.5 stacks of Rotten Flesh.",
                    "nature": "[UNDERPRICE]",
                    "demand": "[6/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": false,
                    "tradable": true,
                    "auctionable": false,
                    "bazaarable": true,
                    "reforgable": false
                },
                {
                    "id": "2",
                    "name": "Zombie Pickaxe",
                    "picture": "img/zombie_pic.png",
                    "rarity": "common",
                    "price": "999",
                    "description": "Gives Haste II for 5 seconds while mining ores.",
                    "nature": "[UNDERPAID]",
                    "demand": "[2/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": true,
                    "tradable": true,
                    "auctionable": true,
                    "bazaarable": false,
                    "reforgable": false
                },
                {
                    "id": "3",
                    "name": "Zombie Hat",
                    "picture": "img/zombie_hat.png",
                    "rarity": "common",
                    "price": "100",
                    "description": "A hat that makes you look like a zombie.",
                    "nature": "[STABLE]",
                    "demand": "[3/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": false,
                    "tradable": true,
                    "auctionable": true,
                    "bazaarable": false,
                    "reforgable": false
                },
                {
                    "id": "4",
                    "name": "Zombie Heart",
                    "picture": "img/zombie_heart.png",
                    "rarity": "rare",
                    "price": "180000",
                    "description": "The heart of a powerful zombie.",
                    "nature": "[OVERPRICE]",
                    "demand": "[5/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": false,
                    "tradable": true,
                    "auctionable": true,
                    "bazaarable": false,
                    "reforgable": false
                },
                {
                    "id": "5",
                    "name": "Zombie Sword",
                    "picture": "img/zombie_sword.png",
                    "rarity": "epic",
                    "price": "400000",
                    "description": "A sword infused with zombie essence.",
                    "nature": "[STABLE]",
                    "demand": "[7/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": true,
                    "tradable": true,
                    "auctionable": true,
                    "bazaarable": false,
                    "reforgable": true
                },
                {
                    "id": "6",
                    "name": "Zombie Armor",
                    "picture": "img/zombie_armor.png",
                    "rarity": "legendary",
                    "price": "1200000",
                    "description": "Armor crafted from zombie remains.",
                    "nature": "[OVERPRICE]",
                    "demand": "[4/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": true,
                    "tradable": true,
                    "auctionable": true,
                    "bazaarable": false,
                    "reforgable": true
                },
                {
                    "id": "7",
                    "name": "Skeleton Helmet",
                    "picture": "img/skeleton_helmet.png",
                    "rarity": "uncommon",
                    "price": "100",
                    "description": "A helmet made from skeleton bones.",
                    "nature": "[UNDERPAID]",
                    "demand": "[3/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": true,
                    "tradable": true,
                    "auctionable": true,
                    "bazaarable": false,
                    "reforgable": false
                },
                {
                    "id": "8",
                    "name": "Enchanted Bone",
                    "picture": "img/enchanted_bone.png",
                    "rarity": "uncommon",
                    "price": "1174",
                    "description": "Crafted from 2.5 stacks of bones.",
                    "nature": "[STABLE]",
                    "demand": "[5/10]",
                    "category": "combat",
                    "craftable": true,
                    "enchantable": false,
                    "tradable": true,
                    "auctionable": false,
                    "bazaarable": true,
                    "reforgable": false
                }
            ];

            // Sample minion prices (from minion-prices.txt)
            minionPricesData = [
                {
                    minionId: 1,
                    tiers: {
                        tier1: [2000, 1000],
                        tier2: [6000, 3000],
                        tier3: [14000, 5000],
                        tier4: [27000, 8000],
                        tier5: [35000, 10000],
                        tier6: [55000, 15000],
                        tier7: [95000, 25000],
                        tier8: [175000, 40000],
                        tier9: [225000, 120000],
                        tier10: [415000, 280000],
                        tier11: [735000, 600000]
                    }
                }
            ];

            // Sample pet prices (from pet-prices.txt)
            petPricesData = [
                {
                    petId: "1",
                    name: "Rabbit Pet",
                    common: 1000,
                    uncommon: 10000,
                    rare: 70000,
                    epic: 280000,
                    legendary: 600000,
                    ncommon: 100,
                    nuncommon: 500,
                    nrare: 1000,
                    nepic: 2000,
                    nlegendary: 5000
                }
            ];

            // Populate the item list for the modal
            populateItemList();
        }

        // Add an item to either seller or buyer side
        function addItem(side) {
            currentSide = side;
            itemModal.style.display = 'block';
        }

        // Close the modal
        function closeModal() {
            itemModal.style.display = 'none';
        }

        // Filter items based on search, category, and rarity
        function searchItems() {
            const searchTerm = itemSearchInput.value.toLowerCase();
            const category = itemCategorySelect.value;
            const rarity = itemRaritySelect.value;
            
            const filteredItems = marketItems.filter(item => {
                // Search term filter
                const nameMatch = item.name.toLowerCase().includes(searchTerm);
                
                // Category filter
                const categoryMatch = category === 'all' || item.category === category;
                
                // Rarity filter
                const rarityMatch = rarity === 'all' || item.rarity === rarity;
                
                return nameMatch && categoryMatch && rarityMatch;
            });
            
            // Display filtered items
            displayItems(filteredItems);
        }

        // Filter items by category and rarity
        function filterItems() {
            searchItems(); // Just trigger a new search
        }

        // Display items in the modal
        function displayItems(items) {
            itemListElement.innerHTML = '';
            
            if (items.length === 0) {
                itemListElement.innerHTML = '<p>No items found</p>';
                return;
            }
            
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item-option';
                
                // Create image element
                const img = document.createElement('img');
                img.src = item.picture;
                img.alt = item.name;
                img.onerror = function() {
                    this.src = 'https://via.placeholder.com/32';
                };
                
                // Create name element with rarity color
                const nameElement = document.createElement('span');
                nameElement.textContent = item.name;
                nameElement.className = item.rarity;
                
                // Create price element
                const priceElement = document.createElement('div');
                priceElement.className = 'item-price';
                priceElement.textContent = `${parseInt(item.price).toLocaleString()} coins`;
                
                // Append elements
                itemElement.appendChild(img);
                itemElement.appendChild(nameElement);
                itemElement.appendChild(priceElement);
                
                // Add click event to select the item
                itemElement.addEventListener('click', () => selectItem(item));
                
                itemListElement.appendChild(itemElement);
            });
        }

        // Select an item to add to the trade
        function selectItem(item) {
            closeModal();
            
            // Create the item slot
            const itemSlot = document.createElement('div');
            itemSlot.className = 'item-slot';
            itemSlot.dataset.type = 'item';
            itemSlot.dataset.id = item.id;
            itemSlot.dataset.price = item.price;
            
            // Create image
            const img = document.createElement('img');
            img.src = item.picture;
            img.alt = item.name;
            img.onerror = function() {
                this.src = 'https://via.placeholder.com/32';
            };
            
            // Create details div
            const detailsDiv = document.createElement('div');
            detailsDiv.className = 'item-details';
            
            // Create name element with rarity color
            const nameElement = document.createElement('div');
            nameElement.className = `item-name ${item.rarity}`;
            nameElement.textContent = item.name;
            
            // Create price element
            const priceElement = document.createElement('div');
            priceElement.className = 'item-price';
            priceElement.textContent = `${parseInt(item.price).toLocaleString()} coins`;
            
            // Create remove button
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-item';
            removeBtn.innerHTML = '&times;';
            removeBtn.addEventListener('click', function() {
                itemSlot.remove();
                updateTotals();
            });
            
            // Append all elements
            detailsDiv.appendChild(nameElement);
            detailsDiv.appendChild(priceElement);
            
            itemSlot.appendChild(img);
            itemSlot.appendChild(detailsDiv);
            itemSlot.appendChild(removeBtn);
            
            // Add to the appropriate side
            if (currentSide === 'seller') {
                sellerItemsContainer.appendChild(itemSlot);
            } else {
                buyerItemsContainer.appendChild(itemSlot);
            }
            
            updateTotals();
        }

        // Calculate the total value for a side
        function calculateSideTotal(side) {
            let total = 0;
            const coinsInput = side === 'seller' ? sellerCoinsInput : buyerCoinsInput;
            const coinsValue = parseInt(coinsInput.value) || 0;
            total += coinsValue;
            
            const itemsContainer = side === 'seller' ? sellerItemsContainer : buyerItemsContainer;
            const items = itemsContainer.querySelectorAll('.item-slot');
            
            items.forEach(item => {
                const price = parseInt(item.dataset.price) || 0;
                total += price;
            });
            
            return total;
        }

        // Update the totals for both sides
        function updateTotals() {
            const sellerTotal = calculateSideTotal('seller');
            const buyerTotal = calculateSideTotal('buyer');
            
            sellerTotalElement.textContent = sellerTotal.toLocaleString();
            buyerTotalElement.textContent = buyerTotal.toLocaleString();
            
            // Update the result display
            calculateTrade();
        }

        // Calculate the trade result
        function calculateTrade() {
            const sellerTotal = parseInt(sellerTotalElement.textContent.replace(/,/g, '')) || 0;
            const buyerTotal = parseInt(buyerTotalElement.textContent.replace(/,/g, '')) || 0;
            
            const difference = buyerTotal - sellerTotal;
            
            let resultText = '';
            let resultClass = 'neutral';
            
            if (difference > 0) {
                resultText = `Profit: +${difference.toLocaleString()} coins`;
                resultClass = 'profit';
            } else if (difference < 0) {
                resultText = `Loss: ${difference.toLocaleString()} coins`;
                resultClass = 'loss';
            } else {
                resultText = 'Trade is even';
            }
            
            resultElement.innerHTML = `<h3>Trade Result</h3><p class="${resultClass}">${resultText}</p>`;
        }

        // Populate the item list with all available items
        function populateItemList() {
            // Display all items initially
            displayItems(marketItems);
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === itemModal) {
                closeModal();
            }
        });
    </script>
</body>
</html>
