<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="assets/cmc-icon.png" type="image/png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Market Prices - CraftersMC Guides</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
  <link rel="stylesheet" href="themes/minecraft/style.css" />
  <script src="js/script.js"></script>
  <style>
    /* --- Profile Card Styles cloned directly from index.html --- */
    .profile-card {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 1001;
      display: none;
      align-items: center;
      gap: 15px;
      background: linear-gradient(135deg, rgba(40, 40, 40, 0.7), rgba(25, 25, 25, 0.8));
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      border-radius: 50px;
      color: white;
      text-decoration: none;
      transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      border: 1px solid rgba(255, 255, 255, 0.15);
      animation: fade-in-down 0.5s ease-out forwards;
      min-width: 200px;
    }
    .profile-card:hover {
      background-color: rgba(0, 0, 0, 0.8);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    #user-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255,255,255,0.2);
      transition: box-shadow 0.3s;
    }
    #user-details { text-align: left; }
    #user-name { font-size: 18px; font-weight: 700; line-height: 1.2; }
    #user-tag { font-size: 12px; font-weight: 700; text-transform: uppercase; opacity: 0.9; margin-top: 3px; display: block; letter-spacing: 0.5px; }
    .profile-card.role-dev #user-avatar { box-shadow: 0 0 15px rgba(213, 0, 0, 0.8); }
    .profile-card.role-manager #user-avatar { box-shadow: 0 0 15px rgba(255, 193, 7, 0.8); }
    .profile-card.role-data-manager #user-avatar { box-shadow: 0 0 15px rgba(41, 98, 255, 0.8); }
    .profile-card.role-rank-seller #user-avatar { box-shadow: 0 0 15px rgba(0, 200, 83, 0.8); }
    @keyframes fade-in-down { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    @media (max-width: 768px) { 
      .profile-card { top: 65px; right: 10px; padding: 8px 14px; gap: 12px; min-width: 0; }
      #user-avatar { width: 40px; height: 40px; }
      #user-name { font-size: 16px; }
      #user-tag { font-size: 10px; }
    }

    /* Market specific styles */
    .private-item-highlight { border: 2px dashed #ff9800; background-color: rgba(255, 152, 0, 0.1); padding: 5px; border-radius: 8px; margin-bottom: 8px; text-align: center; font-weight: bold; color: #ff9800; }
    .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; justify-items: center; margin: 20px; }
    .result { background: rgba(30,30,30,0.85); padding: 12px; border-radius: 8px; width: 100%; max-width: 350px; cursor: pointer; transition: transform 0.2s; color: white; }
    .result:hover { transform: scale(1.02); }
    .market-info-head { display: flex; justify-content: space-between; align-items: center; font-weight: bold; margin-bottom: 6px; }
    .market-info-head img { width: 40px; height: 40px; image-rendering: pixelated; }
    .market-result-div-info { font-size: 14px; margin: 2px 0; }
    .market-coin { width: 16px; height: 16px; vertical-align: middle; margin-left: 4px; }
    .market-description { font-size: 13px; margin-top: 6px; color: #ccc; }
    .rarity-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-bottom: 5px; }
    .rarity-legendary { background-color: #ff9800; color: black; }
    .rarity-epic { background-color: #9c27b0; color: white; }
    .rarity-rare { background-color: #2196f3; color: white; }
    .rarity-uncommon { background-color: #4caf50; color: white; }
    .rarity-common { background-color: #9e9e9e; color: white; }
  </style>
</head>
<body>
  <div id="loader"><div></div><div></div><div></div></div>
  <div class="market-background"></div>

  <!-- Profile Card cloned directly from index.html -->
  <a href="/profile.html" class="profile-card" id="profile-card">
    <img id="user-avatar" src="https://placehold.co/110x110/dddddd/333333?text=...&font=inter" alt="User Avatar" />
    <div id="user-details">
      <div id="user-name">Loading...</div>
      <div id="user-tag"></div>
    </div>
  </a>

  <div class="top"></div>
  <div class="sidebar" id="sidebar"></div>
  <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
  <span class="material-icons" id="scrollToTopBtn">north</span>

  <h1 class="market-title">CraftersMC Market Prices</h1>
  <input type="text" id="searchBox" placeholder="Search Items..." oninput="searchItems()" />
  <div class="market-boxy-box"><div id="results" class="results-grid"></div></div>
  <div class="market-categories">Discover the prices</div>
  <div class="market-divider"></div>

  <!-- category section skipped for brevity -->
  <div id="footer"></div>

  <script>
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return decodeURIComponent(parts.pop().split(';').shift());
      return '';
    }

    // Profile card JS cloned directly from index.html
    async function loadUserInfo() {
      const profileCard = document.getElementById('profile-card');
      const defaultAvatar = "https://placehold.co/110x110/dddddd/333333?text=...&font=inter";
      const avatarEl = document.getElementById('user-avatar');
      const nameEl = document.getElementById('user-name');
      const tagEl = document.getElementById('user-tag');

      try {
        const storedUserCookie = getCookie('discordUser');
        if (!storedUserCookie) { profileCard.style.display = 'none'; return; }
        const loggedInUser = JSON.parse(storedUserCookie);
        const userId = loggedInUser.id;
        if (!userId) { profileCard.style.display = 'none'; return; }

        const response = await fetch(`https://discord-auth.roumakdatta.workers.dev/users/${userId}`);
        if (!response.ok) { profileCard.style.display = 'none'; return; }
        const user = await response.json();

        profileCard.style.display = 'flex';
        const avatarUrl = user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png` : defaultAvatar;
        avatarEl.src = avatarUrl;
        avatarEl.onerror = () => { avatarEl.src = defaultAvatar; };
        nameEl.textContent = user.global_name || user.username || 'Unknown User';

        const roleColors = { dev: '#d50000', manager: '#ffc107', "data manager": '#2962ff', "rank seller": '#00c853' };
        const userRole = user.role ? user.role.toLowerCase() : '';
        profileCard.classList.remove('role-dev','role-manager','role-data-manager','role-rank-seller');
        if (userRole && userRole !== 'normal user') {
          const roleClass = userRole.replace(' ', '-');
          profileCard.classList.add(`role-${roleClass}`);
        }
        if (roleColors[userRole]) {
          tagEl.textContent = user.role.toUpperCase();
          tagEl.style.color = roleColors[userRole];
        } else { tagEl.textContent = ''; tagEl.style.color = ''; }
      } catch (err) { console.error('Error in loadUserInfo:', err); profileCard.style.display = 'none'; }
    }

    document.addEventListener('DOMContentLoaded', () => { loadUserInfo(); });
  </script>
</body>
</html>
