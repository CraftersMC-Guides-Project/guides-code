<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secret Predictor ðŸŒ¾</title>
  <script src="js/script.js" defer></script>
  <style>

  </style>
</head>

<body>
    <div id="loader">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div class="-background"></div>
    <!-- Top Navbar -->
    <div class="top"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar"></div>
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
    <button id="float">
        <span class="material-icons" id="sweepBtn" style="background: #222; border-radius: 50px">chevron_right</span>
        <span class="material-icons" id="homeBtn" onclick="homeBtn()">home</span>
        <span class="material-icons" id="ai" onclick="aiBtn()">smart_toy</span>
        <span class="material-icons" id="scrollToTopBtn">north</span>
    </button>

    <div class="gap"></div>
  <div class="mc-container">
    <div class="corner-left"></div>
    <div class="corner-right"></div>
    <div class="corner-bottom"></div>
    <div class="corner-top"></div>
    <div class="tl-tl"></div>
    <div class="tr-tl s-tl"></div>
    <div class="bl-tl s-tl"></div>
    <div class="br-tl"></div>
    <div class="tr-bl s-bl"></div>
    <div class="bl-tr s-tr"></div>
    <div class="tl-br"></div>
    <div class="tr-br s-br"></div>
    <div class="bl-br s-br"></div>
    <div class="br-br"></div>
    <div class="inventory inner-container">
      <h3>Upcoming Farming Quest</h3>
      <div class="extreme-inner-container">
        <form id="timeForm">
          <input type="datetime-local" id="timeInput" />
          <input type="text" id="cropInput" placeholder="Filter by crop (optional)" />
          <button class="btn" type="submit">Fetch</button>
        </form>
        <table>
          <thead>
            <tr>
              <th>Skyblock Date</th>
              <th>Crops</th>
              <th>When</th>
            </tr>
          </thead>
          <tbody id="contestRows"></tbody>
        </table>
      </div>
    </div>
  </div>
  <!-- <div class="card">
    <h1>ðŸŒ¾ Secret Predictor</h1>
    <form id="timeForm">
      <input type="datetime-local" id="timeInput" />
      <input type="text" id="cropInput" placeholder="Filter by crop (optional)" />
      <button type="submit">Fetch</button>
    </form>
    <p id="info">
      <b>ðŸ•’ Real Time:</b> -<br>
      <b>ðŸŒ¾ Skyblock Now:</b> -
    </p>
    <table>
      <thead>
        <tr>
          <th>Event ID</th>
          <th>Skyblock Date</th>
          <th>Crops</th>
          <th>When</th>
        </tr>
      </thead>
      <tbody id="contestRows"></tbody>
    </table>
  </div> -->

  <script>
    // Format JS date â†’ "DD-MM-YYYY:HH:MM"
    function formatApiDate(d) {
      const pad = n => String(n).padStart(2, "0");
      return `${pad(d.getDate())}-${pad(d.getMonth() + 1)}-${d.getFullYear()}:${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    async function fetchData(time, crop) {
      try {
        let url = `https://bhai-bhai.roumakdatta.workers.dev/api/${time}`;
        if (crop) url += `/${crop}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Bad response " + res.status);
        const data = await res.json();

        // Show real time + skyblock now
        document.getElementById("info").innerHTML =
          `<b>ðŸ•’ Real Time:</b> ${data.real_time || "-"}<br>
           <b>ðŸŒ¾ Skyblock Now:</b> ${data.skyblock_now || "-"}`;

        // Update table
        const tbody = document.getElementById("contestRows");
        tbody.innerHTML = "";
        const row = `<tr>
          <td>${data.skyblockDate || "-"}</td>
          <td>${(data.crops || []).join(", ")}</td>
          <td>${data.timeUntil || "-"}</td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);

      } catch (err) {
        alert("Error fetching data: " + err.message);
      }
    }

    // Handle form submit
    document.getElementById("timeForm").addEventListener("submit", e => {
      e.preventDefault();
      const timeVal = document.getElementById("timeInput").value;
      const cropVal = document.getElementById("cropInput").value.trim().toLowerCase();
      if (!timeVal) return alert("Please select a time!");
      const formatted = formatApiDate(new Date(timeVal));
      fetchData(formatted, cropVal || null);
    });

    // On load â†’ prefill datetime + fetch immediately
    window.addEventListener("DOMContentLoaded", () => {
      const now = new Date();
      document.getElementById("timeInput").value = now.toISOString().slice(0, 16); // prefill input
      const formatted = formatApiDate(now);
      fetchData(formatted, null);
    });
  </script>
</body>

</html>