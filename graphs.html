<!DOCTYPE html>
<html>
<link rel="stylesheet" href="css/essential.css">
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<title>graph?</title>
<body>
  <h1>Market Graphs</h1>
  <p>someone get the worker made soon pls</p>
  <div id="myChart" style="width: 90%; margin: auto;"></div>

<script>

async function generateGraph(itemId) {
  try {
          const historyResponse = await axios.get(`https://chart-bot.roumakdatta.workers.dev/item?id=${itemId}`);
          const historyData = historyResponse.data;
          let chartUrl = null;
          if (Array.isArray(historyData) && historyData.length > 0) {
            const chartConfig = {
              type: 'line',
              data: {
                labels: historyData.map(d => d.date.substring(5)), 
                datasets: [{
                  label: 'Price',
                  data: historyData.map(d => d.price),
                  borderColor: 'rgb(74, 222, 128)',
                  backgroundColor: 'rgba(74, 222, 128, 0.4)',
                  pointRadius: 0,
                  fill: true,
                  tension: 0.1,
                }],
              },
              options: {
                title: { display: false },
                legend: { display: false },
                scales: {
                  yAxes: [{
                    ticks: { fontColor: 'rgba(255, 255, 255, 0.7)', beginAtZero: false,
                      callback: (value) => {
                          if (value >= 1e6) return (value / 1e6) + 'M';
                          if (value >= 1e3) return (value / 1e3) + 'k';
                          return value;
                      }
                    },
                    gridLines: { color: 'rgba(255, 255, 255, 0.1)' }
                  }],
                  xAxes: [{
                    ticks: { fontColor: 'rgba(255, 255, 255, 0.7)', maxTicksLimit: 6 },
                    gridLines: { display: false }
                  }],
                },
              },
            };
            
            const encodedConfig = encodeURIComponent(JSON.stringify(chartConfig));
                     const baseChartUrl = `https://quickchart.io/chart?b=rgb(47,49,54)&c=${encodedConfig}`;

            const watermarkImageUrl = 'https://craftersmc-guides.pages.dev/assets/cmc-guides.png'; // Replace with your actual watermark image URL
            const encodedMainImageUrl = encodeURIComponent(baseChartUrl);
            const encodedMarkImageUrl = encodeURIComponent(watermarkImageUrl);

            const watermarkRatio = 0.2; 
            const watermarkPosition = 'center';
            const watermarkOpacity = 0.1; 

            chartUrl = `https://quickchart.io/watermark?mainImageUrl=${encodedMainImageUrl}&markImageUrl=${encodedMarkImageUrl}&markRatio=${watermarkRatio}&position=${watermarkPosition}&opacity=${watermarkOpacity}`;

            return chartUrl;
          }
        } catch (chartError) {
          console.error(`Could not generate chart for item ${itemId}: ${chartError.message}`);
          // If chart fails, we still send the embed without it.
        }
}

async function displayGraph() {
  const itemId = '1'; // Replace with the actual item ID you want to graph
  const chartUrl = await generateGraph(itemId);
  
  if (chartUrl) {
    const img = document.createElement('img');
    img.src = chartUrl;
    img.style.width = '100%';
    img.style.maxWidth = '900px';
    document.getElementById('myChart').appendChild(img);
  } else {
    console.error('No chart URL generated.');
  }
}
displayGraph();
</script>

</body>
</html>