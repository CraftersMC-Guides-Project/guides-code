<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Skimmer Application</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="themes/minecraft/style.css">
    <script src="js/script.js"></script>
</head>

<body>
    <div id="loader">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div class="form-background"></div>
    <div class="top"></div>

    <div class="sidebar" id="sidebar"></div>
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
    <span class="material-icons" id="scrollToTopBtn">north</span>

    <div class="form-top-button-container">

        <!-- Profile Card Cloned from market.html -->
        <div id="profileCard" class="result">
            <div class="market-info">
                <div class="market-info-head">
                    <b>Loading Profile...</b>
                    <img src="assets/ui-icons/ui_star_active.png" alt="Profile">
                </div>
                <div class="market-result-div-info">ID: ---</div>
                <div class="market-result-div-info">Status: Guest</div>
                <div class="market-description">Log in to see your profile details here.</div>
            </div>
        </div>
        <!-- End Profile Card -->

        <div class="form-card-container">
            <form class="form-form" id="applicationForm"><br>
                <div class="form-panel" id="panel">
                    <svg width="48" height="48" viewBox="0 0 48 48" style="vertical-align:middle; margin-bottom:10px;">
                        <circle cx="24" cy="24" r="22" stroke="#00ff00" fill="transparent" stroke-width="3" />
                        <polyline points="15,25 22,32 34,18" fill="none" stroke="#00ff00" stroke-width="3"
                            stroke-linecap="round" stroke-linejoin="round" />
                    </svg><br><p></p>Application Submitted, Thank you!</p>
                </div>
                <h3 class="form-h3">Data Skimmer Application</h3><br>
                <div class="form-card-content">
                    <!-- Form fields -->
                    <label for="username">1. Discord Username</label>
                    <input id="username" type="text" name="discord" required><br>

                    <label for="Mcusername">2. Minecraft Username</label>
                    <input id="Mcusername" type="text" name="minecraft" required><br>

                    <label for="know">3. Do you know what a Data Skimmer is? If yes, briefly describe your
                        understanding and what your role would be in this position.</label>
                    <textarea id="know" name="dataSkimmer" maxlength="200" placeholder="Max 200"
                        required></textarea><br>

                    <label for="joinwhy">4. Why do you want to join the Data Skimmer team, and what makes you a good fit
                        for this role?</label>
                    <textarea id="joinwhy" name="whyJoin" maxlength="200" placeholder="Max 200" required></textarea><br>

                    <label>5. How much time can you dedicate to the project each day?</label>
                    <label><input type="radio" name="dailyTime" value="less than an hour" required> a) less than an
                        hour</label><br>
                    <label><input type="radio" name="dailyTime" value="1-2 hour"> b) 1–2 hour</label><br>
                    <label><input type="radio" name="dailyTime" value="2-3 hour"> c) 2–3 hour</label><br>
                    <label><input type="radio" name="dailyTime" value="+4 hour"> d) +4 hour</label><br><br>

                    <label for="time">6. Is there any specific time of the day when you will not be available?</label>
                    <textarea id="time" name="unavailable" maxlength="300" placeholder="Max 300"
                        required></textarea><br>

                    <label>7. As a Data Skimmer, you will need to work on updating data every 2–7 days. Are you
                        committed?</label>
                    <label><input type="radio" name="consistency" value="Yes">a) Yes</label><br>
                    <label><input type="radio" name="consistency" value="No">b) No</label><br>
                    <label><input type="radio" name="consistency" value="Intervals">c) Only intervals</label><br><br>

                    <label>8. Can you complete your work on time?</label>
                    <label><input type="radio" name="deadline" value="Always">a) Always</label><br>
                    <label><input type="radio" name="deadline" value="Usually">b) Usually</label><br>
                    <label><input type="radio" name="deadline" value="Struggle">c) Struggle</label><br><br>

                    <label>9. Do you have issues being pinged on Discord?</label>
                    <label><input type="radio" name="contact" value="No issues">a) No issues</label><br>
                    <label><input type="radio" name="contact" value="Prefer not">b) Prefer not</label><br>
                    <label><input type="radio" name="contact" value="Depends">c) Depends</label><br><br>

                    <label>10. Can we trust you to never leak info?</label>
                    <label><input type="radio" name="trust" value="Trustworthy">a) Yes</label><br>
                    <label><input type="radio" name="trust" value="Not trustworthy">b) No</label><br><br>

                    <label for="playtime">11. What is your playtime in CraftersMC, and when did you join?</label>
                    <input id="playtime" type="text" name="playtime" maxlength="300" placeholder="Max 300" required><br>

                    <label for="punishments">12. Do you have any ban/mute history? If yes, explain.</label>
                    <textarea id="punishments" name="banHistory" maxlength="300" placeholder="Max 300"
                        required></textarea><br>

                    <button type="submit">Submit</button>
                </div>
            </form>
        </div>

        <!-- FAQ Section -->
        <div class="form-faq-section">
            <h3 class="form-h3">Frequently Asked Questions</h3>
            <div class="form-faq-dropdown">
                <button type="button" class="form-faq-question">What is a data skimmer?</button>
                <div class="form-faq-answer">
                    <p>A Data Skimmer helps collect, update, and verify in-game data to keep everything accurate.</p>
                </div>
            </div>
            <div class="form-faq-dropdown">
                <button type="button" class="form-faq-question">Do you need coding?</button>
                <div class="form-faq-answer">
                    <p>No coding required, just attention to detail and consistency.</p>
                </div>
            </div>
            <div class="form-faq-dropdown">
                <button type="button" class="form-faq-question">Work frequency?</button>
                <div class="form-faq-answer">
                    <p>Update every 2–7 days to stay consistent with the team’s needs.</p>
                </div>
            </div>
            <div class="form-faq-dropdown">
                <button type="button" class="form-faq-question">How do you put data?</button>
                <div class="form-faq-answer">
                    <p>Data is submitted via forms or directly to team leads.</p>
                </div>
            </div>
            <div class="form-faq-dropdown">
                <button type="button" class="form-faq-question">Perks?</button>
                <div class="form-faq-answer">
                    <p>Recognition, early access to some features, and helping the community.</p>
                </div>
            </div>
            <div class="form-faq-dropdown">
                <button type="button" class="form-faq-question">Do you become staff?</button>
                <div class="form-faq-answer">
                    <p>No, Data Skimmers are trusted contributors, not staff.</p>
                </div>
            </div>
        </div>
        <!-- End FAQ Section -->

        <div id="footer" id="important"></div>
    </div>

    <script>
        let loggedInUsername = null;
        let loggedInUserId = null;

        function getCookie(name) {
            return document.cookie.split('; ').reduce((r, v) => {
                const parts = v.split('=');
                return parts[0] === name ? decodeURIComponent(parts[1]) : r
            }, '');
        }

        document.addEventListener("DOMContentLoaded", () => {
            const storedUserCookie = getCookie("discordUser");
            if (storedUserCookie) {
                try {
                    const userData = JSON.parse(storedUserCookie);
                    loggedInUsername = userData.username;
                    loggedInUserId = userData.id;

                    // Update Profile Card with logged in user info
                    document.getElementById("profileCard").innerHTML = `
                      <div class="market-info">
                        <div class="market-info-head">
                          <b>${loggedInUsername}</b>
                          <img src="assets/ui-icons/ui_star_active.png" alt="${loggedInUsername}">
                        </div>
                        <div class="market-result-div-info">ID: ${loggedInUserId}</div>
                        <div class="market-result-div-info">Role: Data Skimmer Applicant</div>
                        <div class="market-description">Welcome! Your profile is displayed here.</div>
                      </div>`;
                } catch (err) {
                    console.warn("Invalid user cookie format");
                }
            }
        });

        document.getElementById('applicationForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const panel = document.getElementById('panel');
            const form = event.target;
            const formData = new FormData(form);

            const formObject = {};
            formData.forEach((value, key) => {
                formObject[key] = value;
            });

            const payload = {
                type: "data_skimmer_application",
                username: "Application Form",
                content: {
                    type: "data_skimmer_application",
                    reporter: {
                        discord_id: loggedInUserId || "anonymous",
                        discord_username: loggedInUsername || "anonymous",
                        in_game_name: formObject.minecraft || "N/A"
                    },
                    application_data: formObject,
                    timestamp: new Date().toISOString()
                }
            };

            try {
                const res = await fetch('https://webhook-manager.roumakdatta.workers.dev/form', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    panel.classList.add('show');
                    setTimeout(() => {
                        panel.classList.remove('show');
                        form.reset();
                    }, 5000);
                } else {
                    alert('Error submitting form. Server responded with: ' + res.status);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Check console.');
            }
        });

        // FAQ dropdown toggle script
        document.addEventListener('DOMContentLoaded', function () {
            const faqQuestions = document.querySelectorAll('.form-faq-question');
            faqQuestions.forEach(btn => {
                btn.addEventListener('click', function () {
                    this.classList.toggle('active');
                    const answer = this.nextElementSibling;
                    if (answer.style.maxHeight) {
                        answer.style.maxHeight = null;
                    } else {
                        answer.style.maxHeight = answer.scrollHeight + 'px';
                    }
                });
            });
        });
    </script>
</body>
</html>
