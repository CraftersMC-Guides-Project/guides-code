<div class="navbar">
  <span class="menu-icon material-icons" onclick="toggleSidebar()">menu</span>
  <div class="right">
    <span class="menu-icon material-icons" id="darkModeToggle">dark_mode</span>
    <div class="user-menu" id="userMenuContainer">
      </div>
  </div>
</div>

<style>
  .user-menu {
    position: relative;
    display: inline-block;
  }

  .user-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    object-fit: cover;
    background: #444;
  }

  .dropdown {
    display: none;
    position: absolute;
    right: 0;
    top: 45px;
    background-color: #222;
    color: white;
    min-width: 200px;
    border-radius: 8px;
    z-index: 10;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
    padding: 10px;
  }

  .dropdown p {
    margin: 8px 0;
    font-size: 14px;
    word-break: break-word;
  }

  .dropdown button,
  .dropdown a {
    background: none;
    border: none;
    color: white;
    padding: 8px 0;
    text-align: left;
    cursor: pointer;
    width: 100%;
    display: block;
    text-decoration: none;
  }

  .dropdown button:hover,
  .dropdown a:hover {
    background-color: #333;
  }

  .dropdown hr {
    border: 0;
    border-top: 1px solid #444;
    margin: 10px 0;
  }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  // Replace with your actual Firebase configuration
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID",
    measurementId: "YOUR_MEASUREMENT_ID",
  };

  try {
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const container = document.getElementById("userMenuContainer");

    function createDropdownHTML(pfp, name = "", email = "", isGuest = false) {
      return `
        <img src="${pfp}" class="user-avatar" id="userAvatar" onclick="toggleDropdown()" />
        <div class="dropdown" id="userDropdown">
          ${
            isGuest
              ? `
            <p>You are not logged in.</p>
            <a href="/login.html">Login</a>
            <a href="/signup.html">Sign Up</a>
          `
              : `
            <p><strong>${name}</strong></p>
            <p>${email}</p>
            <hr />
            <a href="/settings.html"><span class="material-icons" style="vertical-align: middle;">settings</span> Settings</a>
            <button onclick="logout()">Logout</button>
          `
          }
        </div>
      `;
    }

    function updateAuthUI(user) {
      if (user) {
        const pfp = user.photoURL || "https://upload.wikimedia.org/wikipedia/commons/5/55/Question_Mark.svg";
        container.innerHTML = createDropdownHTML(pfp, user.displayName || "User", user.email);
      } else {
        const guestIcon = "https://upload.wikimedia.org/wikipedia/commons/5/55/Question_Mark.svg";
        container.innerHTML = createDropdownHTML(guestIcon, "", "", true);
      }
    }

    onAuthStateChanged(auth, updateAuthUI);

    window.toggleDropdown = () => {
      const dropdown = document.getElementById("userDropdown");
      if (dropdown) {
        dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
      }
    };

    window.logout = () => {
      signOut(auth)
        .then(() => {
          // Sign-out successful.
          console.log("User signed out");
          // Optionally redirect or reload the page
          location.reload();
        })
        .catch((error) => {
          // An error happened.
          console.error("Error signing out:", error);
        });
    };

    // Hide dropdown if clicked outside
    document.addEventListener("click", (e) => {
      const dropdown = document.getElementById("userDropdown");
      const avatar = document.getElementById("userAvatar");
      if (dropdown && !dropdown.contains(e.target) && e.target !== avatar) {
        dropdown.style.display = "none";
      }
    });
  } catch (error) {
    console.error("Firebase initialization error:", error);
    // Optionally display an error message to the user
  }
      </script>
