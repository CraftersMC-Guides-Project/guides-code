<span class="menu-icon material-icons" onclick="toggleSidebar()">menu</span>
<div class="right">
  <span class="menu-icon material-icons" id="darkModeToggle">dark_mode</span>

  <div id="profileContainer" style="position: relative;">
    <!-- Guest icon -->
    <div id="guestIcon" style="width: 35px; height: 35px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 18px; color: white; cursor: pointer;" onclick="toggleGuestDropdown()">?</div>

    <!-- Logged-in profile image -->
    <img id="userPfp" src="" alt="Profile" style="width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: none;" onclick="toggleProfileDropdown()" />

    <!-- Logged-in dropdown -->
    <div id="profileDropdown" style="display: none; position: absolute; right: 0; background: #1e1e1e; color: white; border-radius: 10px; padding: 10px; min-width: 200px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 10;">
      <div style="text-align: center;">
        <img id="dropdownPfp" src="" style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 10px;">
        <div id="dropdownUsername" style="font-weight: bold;"></div>
        <div id="dropdownEmail" style="font-size: 0.9em; opacity: 0.8;"></div>
      </div>
      <hr style="margin: 10px 0; border-color: #444;">
      <div style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="window.location.href = '../settings.html'">
        <span>Settings</span>
        <span class="material-icons">settings</span>
      </div>
      <div style="margin-top: 10px; text-align: center; cursor: pointer; color: red;" onclick="logoutUser()">Logout</div>
    </div>

    <!-- Guest login/signup form -->
    <div id="guestDropdown" style="display: none; position: absolute; right: 0; background: #1e1e1e; color: white; border-radius: 10px; padding: 15px; min-width: 250px; box-shadow: 0 0 10px rgba(0,0,0,0.5); z-index: 10;">
      <input id="authEmail" type="email" placeholder="Email" style="width: 100%; padding: 8px; margin-bottom: 8px; border-radius: 5px; border: none; outline: none;">
      <input id="authPassword" type="password" placeholder="Password" style="width: 100%; padding: 8px; margin-bottom: 12px; border-radius: 5px; border: none; outline: none;">

      <button onclick="loginUser()" id="loginBtn" style="width: 100%; padding: 8px; background-color: #4caf50; color: white; border: none; border-radius: 5px;">Login</button>
      <button onclick="switchToSignup()" id="switchBtn" style="width: 100%; padding: 8px; background-color: #2196F3; color: white; border: none; border-radius: 5px; margin-top: 8px;">Switch to Sign Up</button>
    </div>
  </div>
</div>

<!-- Firebase Auth Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC9HDieVtkTu_PrSumxoDi1plXduu-J5pg",
    authDomain: "craftersmc-guides.firebaseapp.com",
    projectId: "craftersmc-guides",
    storageBucket: "craftersmc-guides.firebasestorage.app",
    messagingSenderId: "647290515320",
    appId: "1:647290515320:web:44e1be1528c86af00d628d",
    measurementId: "G-K3WGXSF9DQ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const userPfp = document.getElementById("userPfp");
  const guestIcon = document.getElementById("guestIcon");
  const dropdownPfp = document.getElementById("dropdownPfp");
  const dropdownUsername = document.getElementById("dropdownUsername");
  const dropdownEmail = document.getElementById("dropdownEmail");

  onAuthStateChanged(auth, (user) => {
    if (user) {
      const photoURL = user.photoURL || "../assets/default-pfp.png";
      const displayName = user.displayName || "User";
      const email = user.email;

      guestIcon.style.display = "none";
      userPfp.style.display = "inline-block";
      userPfp.src = photoURL;

      dropdownPfp.src = photoURL;
      dropdownUsername.textContent = displayName;
      dropdownEmail.textContent = email;
    } else {
      userPfp.style.display = "none";
      guestIcon.style.display = "flex";
    }
  });

  window.toggleProfileDropdown = () => {
    document.getElementById("profileDropdown").style.display ^= "block";
    document.getElementById("guestDropdown").style.display = "none";
  };

  window.toggleGuestDropdown = () => {
    document.getElementById("guestDropdown").style.display ^= "block";
    document.getElementById("profileDropdown").style.display = "none";
  };

  window.logoutUser = () => {
    signOut(auth).then(() => location.reload());
  };

  window.loginUser = () => {
    const email = document.getElementById("authEmail").value;
    const password = document.getElementById("authPassword").value;
    signInWithEmailAndPassword(auth, email, password)
      .then(() => location.reload())
      .catch(err => alert("Login Failed: " + err.message));
  };

  window.signupUser = () => {
    const email = document.getElementById("authEmail").value;
    const password = document.getElementById("authPassword").value;
    createUserWithEmailAndPassword(auth, email, password)
      .then(() => location.reload())
      .catch(err => alert("Signup Failed: " + err.message));
  };

  window.switchToSignup = () => {
    const loginBtn = document.getElementById("loginBtn");
    const switchBtn = document.getElementById("switchBtn");

    if (loginBtn.textContent === "Login") {
      loginBtn.textContent = "Sign Up";
      loginBtn.onclick = signupUser;
      switchBtn.textContent = "Switch to Login";
    } else {
      loginBtn.textContent = "Login";
      loginBtn.onclick = loginUser;
      switchBtn.textContent = "Switch to Sign Up";
    }
  };
</script>
