<!-- navbar.html -->
<div class="navbar">
  <span class="menu-icon material-icons" onclick="toggleSidebar()">menu</span>
  <div class="right">
    <span class="menu-icon material-icons" id="darkModeToggle">dark_mode</span>
    <div class="user-menu" id="userMenuContainer"></div>
  </div>
</div>

<style>
  .user-menu {
    position: relative;
    display: inline-block;
  }

  .user-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    object-fit: cover;
    background: #ccc;
  }

  .dropdown {
    display: none;
    position: absolute;
    right: 0;
    top: 45px;
    background-color: #222;
    color: white;
    min-width: 200px;
    border-radius: 8px;
    z-index: 10;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.4);
    padding: 10px;
  }

  .dropdown p {
    margin: 8px 0;
    font-size: 14px;
    word-break: break-all;
  }

  .dropdown button, .dropdown a {
    background: none;
    border: none;
    color: white;
    padding: 8px 0;
    text-align: left;
    cursor: pointer;
    width: 100%;
    display: block;
    text-decoration: none;
  }

  .dropdown button:hover, .dropdown a:hover {
    background-color: #333;
  }

  .dropdown hr {
    border: 0;
    border-top: 1px solid #444;
    margin: 10px 0;
  }
</style>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC9HDieVtkTu_PrSumxoDi1plXduu-J5pg",
    authDomain: "craftersmc-guides.firebaseapp.com",
    projectId: "craftersmc-guides",
    storageBucket: "craftersmc-guides.appspot.com",
    messagingSenderId: "647290515320",
    appId: "1:647290515320:web:44e1be1528c86af00d628d",
    measurementId: "G-K3WGXSF9DQ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const container = document.getElementById("userMenuContainer");

  function createUserDropdown(user) {
    const avatarURL = user.photoURL || "https://upload.wikimedia.org/wikipedia/commons/5/55/Question_Mark.svg";

    container.innerHTML = `
      <img src="${avatarURL}" class="user-avatar" id="userAvatar" onclick="toggleDropdown()" />
      <div class="dropdown" id="userDropdown">
        <p><strong>${user.displayName || "No Name"}</strong></p>
        <p>${user.email}</p>
        <hr />
        <a href="/settings.html"><span class="material-icons" style="vertical-align: middle;">settings</span> Settings</a>
        <button onclick="logout()">Logout</button>
      </div>
    `;
  }

  function createGuestDropdown() {
    container.innerHTML = `
      <img src="https://upload.wikimedia.org/wikipedia/commons/5/55/Question_Mark.svg" class="user-avatar" onclick="toggleDropdown()" />
      <div class="dropdown" id="userDropdown">
        <p>You're not logged in.</p>
        <a href="/login.html">Login</a>
        <a href="/signup.html">Sign Up</a>
      </div>
    `;
  }

  onAuthStateChanged(auth, (user) => {
    if (user) {
      createUserDropdown(user);
    } else {
      createGuestDropdown();
    }
  });

  window.toggleDropdown = () => {
    const dropdown = document.getElementById("userDropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  };

  window.logout = () => {
    signOut(auth).then(() => {
      window.location.reload();
    });
  };

  document.addEventListener("click", function (e) {
    const dropdown = document.getElementById("userDropdown");
    const avatar = document.getElementById("userAvatar");
    if (!container.contains(e.target)) {
      dropdown && (dropdown.style.display = "none");
    }
  });
</script>
