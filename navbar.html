<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="style.css"> <title>Your Website Title</title>
</head>
<body>

<nav class="navbar"> <span class="menu-icon material-icons" onclick="toggleSidebar()">menu</span>
    <div class="right">
        <span class="menu-icon material-icons" id="darkModeToggle">dark_mode</span>

        <div id="authContainer">
            <button id="authButton" class="auth-button">
                <span class="material-icons">help_outline</span> </button>
            <div id="userDropdown" class="dropdown-content">
                <a href="#" id="logoutButton">Logout</a>
                </div>
        </div>
        </div>
</nav>

<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closeLoginModal()">&times;</span>
        <h2>Login / Sign Up</h2>
        <div id="authError" class="error-message"></div>

        <form id="emailPasswordForm">
            <input type="email" id="emailInput" placeholder="Email" required>
            <input type="password" id="passwordInput" placeholder="Password" required>
            <button type="button" id="loginButton">Login</button>
            <button type="button" id="signupButton">Sign Up</button>
        </form>

        <hr>
        <p>Or sign in with:</p>
        <button type="button" id="googleSignInButton">
             <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google logo" width="20" height="20" style="vertical-align: middle; margin-right: 8px;">
             Sign in with Google
        </button>
         </div>
</div>
<main>
    <h1>Page Content</h1>
    <p>This is the rest of your page.</p>
</main>

<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.7/firebase-auth-compat.js"></script>
<script>
    // Your Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC9HDieVtkTu_PrSumxoDi1plXduu-J5pg", // IMPORTANT: Keep this safe if using backend rules
      authDomain: "craftersmc-guides.firebaseapp.com",
      projectId: "craftersmc-guides",
      storageBucket: "craftersmc-guides.appspot.com", // Corrected storage bucket domain
      messagingSenderId: "647290515320",
      appId: "1:647290515320:web:44e1be1528c86af00d628d",
      measurementId: "G-K3WGXSF9DQ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const googleProvider = new firebase.auth.GoogleAuthProvider(); // For Google Sign-In

    // DOM Elements
    const authContainer = document.getElementById('authContainer');
    const authButton = document.getElementById('authButton');
    const userDropdown = document.getElementById('userDropdown');
    const logoutButton = document.getElementById('logoutButton');
    const loginModal = document.getElementById('loginModal');
    const emailInput = document.getElementById('emailInput');
    const passwordInput = document.getElementById('passwordInput');
    const loginButton = document.getElementById('loginButton');
    const signupButton = document.getElementById('signupButton');
    const googleSignInButton = document.getElementById('googleSignInButton');
    const authError = document.getElementById('authError');

    // --- Modal Functions ---
    function openLoginModal() {
        loginModal.style.display = 'block';
        authError.textContent = ''; // Clear previous errors
    }

    function closeLoginModal() {
        loginModal.style.display = 'none';
    }

    // Close modal if clicked outside of it
    window.onclick = function(event) {
        if (event.target == loginModal) {
            closeLoginModal();
        }
    }

    // --- Auth State Change Handler ---
    auth.onAuthStateChanged(user => {
        if (user) {
            // --- User is Signed In ---
            console.log("User logged in:", user.email);
            closeLoginModal(); // Close modal if open
            authButton.innerHTML = ''; // Clear previous content

            // Display Profile Picture or Initials/Icon
            if (user.photoURL) {
                const img = document.createElement('img');
                img.src = user.photoURL;
                img.alt = "Profile Picture";
                img.classList.add('profile-pic'); // Add class for styling
                authButton.appendChild(img);
            } else {
                // Fallback: Use a generic user icon or initials
                const userIcon = document.createElement('span');
                userIcon.classList.add('material-icons');
                userIcon.textContent = 'person'; // Material icon for user
                authButton.appendChild(userIcon);
                // Or display initials:
                // const initials = user.email ? user.email[0].toUpperCase() : '?';
                // authButton.textContent = initials;
                // authButton.classList.add('profile-initials'); // Add class for styling
            }

            // Configure auth button for logged-in state (toggle dropdown)
            authButton.onclick = () => {
                 userDropdown.style.display = userDropdown.style.display === 'block' ? 'none' : 'block';
            };
            userDropdown.style.display = 'none'; // Hide dropdown initially


        } else {
            // --- User is Signed Out ---
            console.log("User logged out");
            authButton.innerHTML = '<span class="material-icons">help_outline</span>'; // Show question mark/login icon
            userDropdown.style.display = 'none'; // Hide dropdown

            // Configure auth button for logged-out state (open modal)
            authButton.onclick = openLoginModal;
        }
    });

    // --- Event Listeners for Auth Actions ---

    // Login with Email/Password
    loginButton.addEventListener('click', () => {
        const email = emailInput.value;
        const password = passwordInput.value;
        authError.textContent = ''; // Clear errors

        if (!email || !password) {
            authError.textContent = 'Please enter both email and password.';
            return;
        }

        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                // Signed in
                console.log("Logged in successfully:", userCredential.user.email);
                // Modal will close via onAuthStateChanged
            })
            .catch((error) => {
                console.error("Login Error:", error);
                authError.textContent = `Login failed: ${error.message}`;
            });
    });

    // Sign Up with Email/Password
    signupButton.addEventListener('click', () => {
        const email = emailInput.value;
        const password = passwordInput.value;
         authError.textContent = ''; // Clear errors

        if (!email || !password) {
            authError.textContent = 'Please enter both email and password.';
            return;
        }
         if (password.length < 6) {
             authError.textContent = 'Password should be at least 6 characters.';
             return;
         }


        auth.createUserWithEmailAndPassword(email, password)
            .then((userCredential) => {
                // Signed up and signed in
                console.log("Signed up successfully:", userCredential.user.email);
                 // Modal will close via onAuthStateChanged
            })
            .catch((error) => {
                 console.error("Sign Up Error:", error);
                 authError.textContent = `Sign up failed: ${error.message}`;
            });
    });

    // Sign In with Google
    googleSignInButton.addEventListener('click', () => {
         authError.textContent = ''; // Clear errors
         auth.signInWithPopup(googleProvider)
            .then((result) => {
                // This gives you a Google Access Token. You can use it to access the Google API.
                const credential = result.credential;
                const token = credential.accessToken;
                // The signed-in user info.
                const user = result.user;
                console.log("Google Sign-In Success:", user);
                // Modal will close via onAuthStateChanged
            }).catch((error) => {
                // Handle Errors here.
                const errorCode = error.code;
                const errorMessage = error.message;
                // The email of the user's account used.
                const email = error.email;
                // The firebase.auth.AuthCredential type that was used.
                const credential = error.credential;
                 console.error("Google Sign-In Error:", error);
                 authError.textContent = `Google Sign-in failed: ${errorMessage}`;
            });
    });


    // Logout
    logoutButton.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent default link behavior
        auth.signOut().then(() => {
            console.log("Logout successful");
            userDropdown.style.display = 'none'; // Hide dropdown immediately
            // UI update will happen via onAuthStateChanged
        }).catch((error) => {
            console.error("Logout Error:", error);
            alert("Logout failed: " + error.message); // Simple alert for logout error
        });
    });

    // --- Sidebar Function (Keep yours if it works) ---
    function toggleSidebar() {
        // Add your sidebar toggle logic here
        console.log("Toggle Sidebar clicked");
        // Example: document.getElementById('mySidebar').classList.toggle('active');
    }

    // --- Dark Mode Toggle (Keep yours) ---
    const darkModeToggle = document.getElementById('darkModeToggle');
    darkModeToggle.addEventListener('click', () => {
        // Add your dark mode toggle logic here
        console.log("Dark Mode toggle clicked");
        // Example: document.body.classList.toggle('dark-mode');
    });


</script>

</body>
</html>
