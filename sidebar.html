<script>
document.addEventListener("DOMContentLoaded", () => {
    const profileImg = document.getElementById("sidebarProfilePic");
    const usernameText = document.getElementById("sidebarUsername");
    const sidebarNameElement = document.getElementById("sidebarName");
    const sidebarAvatarElement = document.getElementById("sidebarAvatar");
    const sidebarAvatarImgElement = document.getElementById("sidebarAvatarImg");

    try {
        const storedUser = localStorage.getItem("discordUser");
        if (storedUser) {
            const userData = JSON.parse(storedUser);
            console.log("Retrieved user data from localStorage:", userData);

            profileImg.src = "../assets/cmc-guides.png";
            usernameText.textContent = `${userData.username}#${userData.discriminator}`;
            sidebarNameElement.textContent = userData.username;

            if (userData.rank) {
                const tag = document.createElement("span");
                tag.textContent = userData.rank;
                tag.style.backgroundColor = (userData.rank.toLowerCase() === "coder") ? "#4caf50" :
                                            (userData.rank.toLowerCase() === "data skimmer") ? "#2196f3" :
                                            (userData.rank.toLowerCase() === "member") ? "#9e9e9e" :
                                            "#555";
                tag.style.color = "white";
                tag.style.fontSize = "10px";
                tag.style.padding = "2px 6px";
                tag.style.borderRadius = "8px";
                tag.style.marginLeft = "6px";
                tag.style.textTransform = "uppercase";
                tag.style.fontWeight = "bold";
                tag.style.verticalAlign = "middle";
                tag.style.display = "inline-block";

                sidebarNameElement.appendChild(tag);
            }

            if (userData.avatar) {
                const avatarUrl = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;
                sidebarAvatarElement.style.display = 'block';
                sidebarAvatarImgElement.src = avatarUrl;
            } else {
                sidebarAvatarElement.style.display = 'none';
            }

        } else {
            profileImg.src = "../assets/cmc-guides.png";
            usernameText.textContent = "";
            sidebarNameElement.textContent = "Name";
            sidebarAvatarElement.style.display = 'none';
        }
    } catch (error) {
        console.error("Error accessing localStorage or parsing user data:", error);
        profileImg.src = "../assets/cmc-guides.png";
        usernameText.textContent = "";
        sidebarNameElement.textContent = "Name";
        sidebarAvatarElement.style.display = 'none';
    }
});
</script>
