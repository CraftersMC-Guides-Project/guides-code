<script>
document.addEventListener("DOMContentLoaded", () => {
    const profileImg = document.getElementById("sidebarProfilePic");
    const usernameText = document.getElementById("sidebarUsername");
    const sidebarNameElement = document.getElementById("sidebarName");
    const sidebarAvatarElement = document.getElementById("sidebarAvatar");
    const sidebarAvatarImgElement = document.getElementById("sidebarAvatarImg");

    try {
        const storedUser = localStorage.getItem("discordUser");
        if (storedUser) {
            const userData = JSON.parse(storedUser);
            console.log("Retrieved user data from localStorage:", userData);

            //Set CMC guides logo
            profileImg.src = "../assets/cmc-guides.png";

            usernameText.textContent = `${userData.username}#${userData.discriminator}`;
            let rankHtml = ''; // Initialize an empty string for the rank tag

            if (userData.rank) {
                rankHtml = `<span style="margin-left: 5px; font-size: 0.8rem; color: #ffffff; border-radius: 5px; padding: 2px 5px; display: inline-block;" class="user-rank rank-${userData.rank.toLowerCase()}">
                              ${userData.rank}
                            </span>`;
                 if (userData.rank === "Coder") {
                    rankHtml = `<span style="margin-left: 5px; font-size: 0.8rem; color: #ffffff; border-radius: 5px; padding: 2px 5px; display: inline-block; background-color: #007bff;" class="user-rank rank-${userData.rank.toLowerCase()}">
                              ${userData.rank}
                            </span>`;
                } else if (userData.rank === "Data Skimmer") {
                     rankHtml = `<span style="margin-left: 5px; font-size: 0.8rem; color: #ffffff; border-radius: 5px; padding: 2px 5px; display: inline-block; background-color: #4CAF50;" class="user-rank rank-${userData.rank.toLowerCase()}">
                              ${userData.rank}
                            </span>`;
                } else if (userData.rank === "Member") {
                    rankHtml = `<span style="margin-left: 5px; font-size: 0.8rem; color: #ffffff; border-radius: 5px; padding: 2px 5px; display: inline-block; background-color: #808080;" class="user-rank rank-${userData.rank.toLowerCase()}">
                              ${userData.rank}
                            </span>`;
                }
            }
            sidebarNameElement.innerHTML = userData.username + rankHtml;

            if (userData.avatar) {
                const avatarUrl = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;
                sidebarAvatarElement.style.display = 'block';
                sidebarAvatarImgElement.src = avatarUrl;
            } else {
                sidebarAvatarElement.style.display = 'none';
            }


        } else {
            profileImg.src = "../assets/cmc-guides.png";
            usernameText.textContent = "";
            sidebarNameElement.textContent = "Name";
            sidebarAvatarElement.style.display = 'none';
        }
    } catch (error) {
        console.error("Error accessing localStorage or parsing user data:", error);
        profileImg.src = "../assets/cmc-guides.png";
        usernameText.textContent = "";
        sidebarNameElement.textContent = "Name";
        sidebarAvatarElement.style.display = 'none';
    }
});
</script>
