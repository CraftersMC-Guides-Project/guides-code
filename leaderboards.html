<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="assets/cmc-icon.png" type="image/png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="CraftersMC Leaderboards">
    <meta property="og:description"
        content="Explore all types of leaderboards here! Whether...find out positions or collections, all data is available here!">
    <meta property="og:image" content="">
    <meta property="og:url" content="https://craftersmc-guides.pages.dev/leaderboards">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#007bff">
    <title>CraftersMC Leaderboards</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="themes/minecraft/style.css">
    <script src="js/script.js"></script>

    <style>
        /* Profile Card Styles */
        #top-right-ui-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
        }
        .profile-card {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: rgba(0,0,0,0.5);
            padding: 8px 12px;
            border-radius: 50px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .profile-card:hover { background-color: rgba(0,0,0,0.8); }
        .profile-card-avatar { width: 32px; height: 32px; border-radius: 50%; }
        .profile-card-name { font-weight: 500; font-size: 14px; }
        .dev-label { color: #ff4d4d; font-weight: bold; margin-left: 5px; }
        @media (max-width: 768px) {
            #top-right-ui-container { top: 65px; right: 10px; gap: 8px; }
            .profile-card { padding: 4px 8px; }
            .profile-card-avatar { width: 28px; height: 28px; }
            .profile-card-name { font-size: 12px; }
        }
    </style>
</head>

<body>
    <div id="loader">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <!-- Profile card container -->
    <div id="top-right-ui-container">
        <div id="profile-card-container"></div>
    </div>

    <!-- This is the main selection view, shown on first visit -->
    <div id="main-selection-view">
        <div class="leaderboard-interface-background"></div>
        <div class="top"></div>
        <div class="sidebar" id="main-sidebar"></div>
        <div id="main-sidebar-overlay" onclick="toggleSidebar()"></div>
        <span class="material-icons" id="main-scrollToTopBtn">north</span>
        <div class="event-log-card-container">
            <div class="event-log-card">
                <img src="Backgrounds/IMG_4504.webp" alt="Collections Leaderboards"
                    onerror="this.onerror=null;this.src='https://placehold.co/600x400/222/fff?text=Collections';">
                <div class="event-log-card-content">
                    <h3>Collections Leaderboards</h3>
                    <p>Find out who is at what ranking and how much collection they have.</p>
                    <button onclick="showLeaderboardView('collections')">View Leaderboards</button>
                </div>
            </div>
            <div class="event-log-card">
                <img src="Backgrounds/image9489.webp" alt="Slayers Leaderboards"
                    onerror="this.onerror=null;this.src='https://placehold.co/600x400/222/fff?text=Slayers';">
                <div class="event-log-card-content">
                    <h3>Slayers Leaderboards</h3>
                    <p>Find out who is at what position and how much experience they have.</p>
                    <button onclick="showLeaderboardView('slayers')">View Leaderboards</button>
                </div>
            </div>
        </div>
    </div>

    <!-- This is the dynamic leaderboard view, hidden by default -->
    <div id="leaderboard-view" style="display: none;">
        <div class="leaderboard-unified-background"></div>
        <div id="sidebar-overlay" onclick="overlay()"></div>
        <!-- Navbar -->
        <div class="custom-navbar">
            <div class="left">
                <div class="button-wrapper">
                    <div class="button-tip" id="tooltip">Click to proceed!</div>
                    <span class="openbtn menu-icon material-icons" onclick="toggleLid()" id="continue-btn">sort</span>
                </div>
                <span class="menu-icon material-icons" onclick="toggleSidebar()">menu</span>
            </div>
            <div class="right">
                <a href="index.html"><img src="assets/cmc-guides.png"></a>
            </div>
        </div>
        <div id="sidelid" class="sidelid">
            <div id="selection-panel">
                <!-- Content changes based on leaderboard type -->
            </div>
        </div>
        <div class="lb-content">
            <!-- Sidebar -->
            <div class="sidebar" id="leaderboard-sidebar"></div>
            <button id="float">
                <span class="material-icons" id="homeBtn" onclick="goHome()">home</span>
                <span class="material-icons" id="sweepBtn"
                    style="background: #222; border-radius: 50px;">chevron_right</span>
                <span class="material-icons" id="ai" onclick="aiBtn()">smart_toy</span>
                <span class="material-icons" id="scrollToTopBtn">north</span>
            </button>
            <div>
                <div class="lb-container">
                    <div class="leaderboard-type-selector">
                        <button id="collectionsBtn">Collections</button>
                        <button id="slayersBtn">Slayers</button>
                    </div>
                    <h3 class="lb-h3" id="mainTitle">CraftersMC Leaderboards</h3>
                    <p>Find out who is at what ranking and how much collection they have using our easy to use tool.</p>
                    <br>
                    <p id="mobileGuide">Click on the icon with 3 different length lines at the top left of the screen to
                        select any collection and see the top 10 highest ranked players in the collection on the table.
                    </p>
                    <br id="mobileGuide">
                    <p>Select a category and collection to view the top 10 players.</p>
                    <div class="lb-leaderboard">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 class="lb-h2" id="collectionTitle">Select a Collection</h2>
                            <p id="lastUpdated" style="font-size: 0.8em; color: #ccc;"></p>
                        </div>
                        <table class="lb-table">
                            <thead>
                                <tr id="leaderboard-header">
                                    <th>Rank</th>
                                    <th>Player</th>
                                    <th>Score</th>
                                </tr>
                            </thead>
                            <tbody id="leaderboardData"></tbody>
                        </table>
                        <br>
                        <details>
                            <summary>What Once Was: A Legacy Remembered</summary>
                            <hr>
                            <div class="lb-message">
                                The first leaderboard website was made by NumberOne230564 and David_R06 using Google
                                Docs,
                                which was pretty basic. Later, CraftersMC Guides made it better by designing a new,
                                nicer
                                website and got information from the original Google Docs site. This message gives a
                                shoutout to their work, and we want to make it clear that we didn't gather all the early
                                data ourselves. Right now, NumberOne230564 and his team run a different website that is
                                new
                                and was created after their Google Docs site, while we take care of this other website
                                and
                                collect our own data.
                            </div>
                        </details>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="footer"></div>

    <script>
        function setCookie(name, value, options = {}) {
            options = { path: '/', ...options };
            if (options.expires instanceof Date) {
                options.expires = options.expires.toUTCString();
            }
            let updatedCookie = encodeURIComponent(name) + "=" + encodeURIComponent(value);
            for (let optionKey in options) {
                updatedCookie += "; " + optionKey;
                let optionValue = options[optionKey];
                if (optionValue !== true) {
                    updatedCookie += "=" + optionValue;
                }
            }
            document.cookie = `${name}=${value || ""}${expires}; path=/`;
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let c of ca) {
                c = c.trim();
                if (c.startsWith(nameEQ)) return c.substring(nameEQ.length);
            }
            return null;
        }

        async function fetchData(path) {
            const res = await fetch(path);
            if (!res.ok) throw new Error(`Failed to fetch ${path}`);
            return await res.text();
        }

        function lastUpdatedTimestamp() {
            const now = new Date();
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const h12 = (h) => {
                const ampm = h >= 12 ? "PM" : "AM";
                const hh = h % 12 || 12;
                return [hh, ampm];
            };
            const [hh, ampm] = h12(now.getHours());
            const mm = String(now.getMinutes()).padStart(2, "0");
            return `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}, ${hh}:${mm} ${ampm}`;
        }

        function overlay() {
            const overlay = document.getElementById('sidebar-overlay');
            overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlayEl = document.getElementById('sidebar-overlay');
            const isOpen = sidebar.classList.toggle('open');
            overlayEl.style.display = isOpen ? 'block' : 'none';
        }

        function toggleLid() {
            const lid = document.getElementById('sidelid');
            lid.classList.toggle('open');
            document.getElementById('tooltip').style.display = 'none';
        }

        function showLeaderboardView(type) {
            document.getElementById('main-selection-view').style.display = 'none';
            document.getElementById('leaderboard-view').style.display = 'block';
            initializeLeaderboard(type);
        }

        function goHome() {
            document.getElementById('leaderboard-view').style.display = 'none';
            document.getElementById('main-selection-view').style.display = 'block';
        }

        (function () {
            const selectionPanel = document.getElementById('selection-panel');
            const headerRow = document.getElementById('leaderboard-header');
            const dataBody = document.getElementById('leaderboardData');
            const lastUpdated = document.getElementById('lastUpdated');
            const mainTitle = document.getElementById('mainTitle');
            const collectionTitle = document.getElementById('collectionTitle');

            const COLLECTIONS = {
                "Farming": ["Wheat", "Carrot", "Potato", "Pumpkin", "Melon", "Sugar Cane", "Cactus", "Mushroom", "Cocoa Beans", "Nether Wart"],
                "Mining": ["Cobblestone", "Coal", "Iron", "Gold", "Diamond", "Emerald", "Obsidian", "Lapis Lazuli", "Quartz", "Glowstone", "Redstone", "Sand", "Gravel", "Netherrack", "End Stone"],
                "Foraging": ["Oak Wood", "Spruce Wood", "Birch Wood", "Jungle Wood", "Acacia Wood", "Dark Oak Wood"],
                "Fishing": ["Raw Fish", "Raw Salmon", "Clownfish", "Pufferfish", "Prismarine Shard", "Prismarine Crystals", "Ink Sac"]
            };

            const SLAYERS = {
                "Zombie": ["Revenant Horror"],
                "Spider": ["Tarantula Broodfather"],
                "Wolf": ["Sven Packmaster"],
                "Enderman": ["Voidgloom Seraph"]
            };

            function clearSelectionPanel() {
                selectionPanel.innerHTML = '';
            }

            function createSelectionButtons(type, items) {
                clearSelectionPanel();
                const title = document.createElement('h3');
                title.textContent = (type === 'collections') ? 'Collections' : 'Slayers';
                selectionPanel.appendChild(title);

                const container = document.createElement('div');
                container.className = 'selection-buttons';

                Object.entries(items).forEach(([category, list]) => {
                    const details = document.createElement('details');
                    const summary = document.createElement('summary');
                    summary.textContent = category;
                    details.appendChild(summary);

                    list.forEach(item => {
                        const btn = document.createElement('button');
                        btn.textContent = item;
                        btn.onclick = () => loadLeaderboard(category, item);
                        details.appendChild(btn);
                    });

                    container.appendChild(details);
                });

                selectionPanel.appendChild(container);
            }

            function setHeaders(type) {
                if (type === 'collections') {
                    headerRow.innerHTML = `
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Collection</th>
                        <th>Amount</th>
                    `;
                } else {
                    headerRow.innerHTML = `
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Boss</th>
                        <th>XP</th>
                    `;
                }
            }

            async function initializeLeaderboard(type) {
                if (type === 'collections') {
                    createSelectionButtons('collections', COLLECTIONS);
                    mainTitle.textContent = 'Collections Leaderboards';
                } else {
                    createSelectionButtons('slayers', SLAYERS);
                    mainTitle.textContent = 'Slayers Leaderboards';
                }
                setHeaders(type);
                dataBody.innerHTML = '';
                collectionTitle.textContent = 'Select a ' + (type === 'collections' ? 'Collection' : 'Boss');
            }

            async function loadLeaderboard(category, item) {
                collectionTitle.textContent = `${item} - Top Players`;
                lastUpdated.textContent = `Last Updated: ${lastUpdatedTimestamp()}`;

                // Replace these fetch paths with your real data endpoints
                // Expected CSV format: rank,player,value
                const path = (Object.keys(COLLECTIONS).includes(category))
                    ? `leaderboards/collections/${item.replace(/\s+/g, '_').toLowerCase()}.csv`
                    : `leaderboards/slayers/${item.replace(/\s+/g, '_').toLowerCase()}.csv`;

                try {
                    const csv = await fetchData(path);
                    const rows = csv.trim().split('\n').map(r => r.split(','));
                    dataBody.innerHTML = rows.map((r, i) => `
                        <tr>
                            <td>${r[0] || i + 1}</td>
                            <td>${r[1] || ''}</td>
                            <td>${item}</td>
                            <td>${r[2] || ''}</td>
                        </tr>
                    `).join('');
                } catch (e) {
                    dataBody.innerHTML = `<tr><td colspan="4">No data available for ${item}</td></tr>`;
                }

                // Remember last viewed
                setCookie('lastLeaderboardType', Object.keys(COLLECTIONS).includes(category) ? 'collections' : 'slayers', { expires: new Date(Date.now() + 86400000 * 365) });
                setCookie('lastLeaderboardCategory', category, { expires: new Date(Date.now() + 86400000 * 365) });
                setCookie('lastLeaderboardItem', item, { expires: new Date(Date.now() + 86400000 * 365) });
            }

            // Expose to global for buttons
            window.initializeLeaderboard = initializeLeaderboard;
            window.loadLeaderboard = loadLeaderboard;

            // Re-open last viewed leaderboard if cookie exists
            document.addEventListener('DOMContentLoaded', () => {
                const type = getCookie('lastLeaderboardType');
                const categoryToLoad = getCookie('lastLeaderboardCategory');
                const itemToLoad = getCookie('lastLeaderboardItem');
                if (type) {
                    showLeaderboardView(type);
                    if (categoryToLoad && itemToLoad) {
                        window.loadLeaderboard(categoryToLoad, itemToLoad);
                    }
                }
            });
        })();

        document.addEventListener('DOMContentLoaded', () => {
            const lastType = getCookie('lastLeaderboardType');
            if (lastType) {
                showLeaderboardView(lastType);
            }
        });
    </script>

    <!-- Profile Card loader (kept separate for clarity) -->
    <script>
    (function(){
        async function loadProfileCard(){
            try {
                var profileContainer = document.getElementById("profile-card-container");
                if(!profileContainer) return;
                var raw = (typeof getCookie === 'function') ? getCookie("discordUser") : null;
                if(!raw){ profileContainer.innerHTML = ""; return; }
                try { raw = decodeURIComponent(raw); } catch(e){}
                var user = null;
                try { user = JSON.parse(raw); } catch(e){ user = null; }
                if(!user){ profileContainer.innerHTML = ""; return; }

                // Load dev IDs
                var devIds = [];
                try {
                    var res = await fetch('/devs.txt');
                    if(res.ok){
                        var text = await res.text();
                        devIds = text.split('\n').map(function(x){ return x.trim(); }).filter(Boolean);
                    }
                } catch(e){ /* ignore */ }

                var displayName = user.global_name || user.username || "User";
                var isDev = devIds.indexOf(user.id) !== -1;
                var avatarUrl = user.avatar ? ("https://cdn.discordapp.com/avatars/" + user.id + "/" + user.avatar + ".png") : "https://placehold.co/64x64";

                profileContainer.innerHTML = '<a href="/profile" class="profile-card">'
                    + '<img src="'+avatarUrl+'" alt="Avatar" class="profile-card-avatar">'
                    + '<span class="profile-card-name">'+ displayName + (isDev ? ' <span class="dev-label">[DEV]</span>' : '') + '</span>'
                    + '</a>';
            } catch(err){
                /* silent */
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadProfileCard);
        } else {
            loadProfileCard();
        }
    })();
    </script>
</body>

</html>
