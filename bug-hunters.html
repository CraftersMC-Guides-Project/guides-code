<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="icon" href="assets/cmc-icon.png" type="image/png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bug Hunters - CraftersMC Guides</title>
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="themes/minecraft/style.css" />
  </head>
  <body>
    <div id="loader">
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div class="bug-background"></div>
    <div class="top"></div>
    <div class="sidebar" id="sidebar"></div>
    <div id="sidebar-overlay" onclick="toggleSidebar()"></div>
    <span class="material-icons bug-mat-icons" id="scrollToTopBtn">north</span>

    <!--  -->
    <div class="bug-hunters-container">
      <h1 class="bug-h1">Bug Hunters Hall of Fame</h1>
      <div class="bug-intro-text">
        <p>
          These are the amazing community members who have helped improve
          CraftersMC Guides by reporting bugs and issues. We appreciate their
          contributions!
        </p>
        <p>
          The more bugs you report, the higher you'll climb on the leaderboard!
        </p>
      </div>

      <div id="topHunters" class="bug-top-hunters">
        <h2>Top Bug Hunters</h2>
        <div class="bug-hunters-grid" id="topHuntersGrid">
          <div class="bug-loading">Loading top hunters...</div>
        </div>
      </div>

      <div id="allHunters">
        <h2>All Bug Hunters</h2>
        <div class="bug-hunters-grid" id="allHuntersGrid">
          <div class="bug-loading">Loading all hunters...</div>
        </div>
      </div>
    </div>

    <div id="footer"></div>

    <script src="js/script.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          // Fetch the bug hunters data
          const response = await fetch("bugs/hunters.json");
          if (!response.ok) {
            throw new Error("Failed to load bug hunters data");
          }
          const huntersData = await response.json();

          // Convert object to array, filter out negative bug counts, and sort by bug count (descending)
          const sortedHunters = Object.entries(huntersData)
            .map(([id, hunter]) => ({
              id,
              username: hunter.username,
              ign: hunter.ign || hunter.username, // Fallback to Discord username if IGN not provided
              avatar: hunter.avatar,
              bugCount: hunter.bugCount,
            }))
            .filter((hunter) => hunter.bugCount >= 0) // Exclude hunters with negative bug counts
            .sort((a, b) => b.bugCount - a.bugCount);

          // Display top 3 hunters
          const topHuntersGrid = document.getElementById("topHuntersGrid");
          topHuntersGrid.innerHTML = "";

          sortedHunters.slice(0, 3).forEach((hunter, index) => {
            const rankClass = `bug-rank-${index + 1}`;
            const trophyIcon =
              index === 0
                ? "emoji_events"
                : index === 1
                ? "military_tech"
                : "workspace_premium";
            const trophyColor =
              index === 0 ? "bug-gold" : index === 1 ? "bug-silver" : "bug-bronze";

            topHuntersGrid.innerHTML += `
                        <div class="bug-hunter-card">
                            <div class="bug-trophy-container">
                                <img src="${hunter.avatar}" 
                                     alt="${
                                       hunter.username
                                     }" class="bug-hunter-avatar top-hunter-avatar">
                                <span class="material-icons bug-mat-icons bug-trophy-icon ${trophyColor}">${trophyIcon}</span>
                            </div>
                            <div class="bug-hunter-name">${
                              hunter.username
                            }</div>
                            <div class="bug-hunter-ign">${hunter.ign}</div>
                            <div class="bug-hunter-bugs">${
                              hunter.bugCount
                            } bug${
              hunter.bugCount !== 1 ? "s" : ""
            } reported</div>
                            <div class="bug-hunter-rank ${rankClass}">
                                ${
                                  index === 0
                                    ? "1st Place"
                                    : index === 1
                                    ? "2nd Place"
                                    : "3rd Place"
                                }
                            </div>
                        </div>
                    `;
          });

          // Display all hunters
          const allHuntersGrid = document.getElementById("allHuntersGrid");
          allHuntersGrid.innerHTML = "";

          sortedHunters.slice(3).forEach((hunter, index) => {
            allHuntersGrid.innerHTML += `
                        <div class="bug-hunter-card">
                            <img src="${hunter.avatar}" 
                                 alt="${
                                   hunter.username
                                 }" class="bug-hunter-avatar">
                            <div class="bug-hunter-name">${
                              hunter.username
                            }</div>
                            <div class="bug-hunter-ign">${hunter.ign}</div>
                            <div class="bug-hunter-bugs">${
                              hunter.bugCount
                            } bug${
              hunter.bugCount !== 1 ? "s" : ""
            } reported</div>
                            <div class="bug-hunter-rank bug-rank-other">
                                #${index + 4}
                            </div>
                        </div>
                    `;
          });
        } catch (error) {
          console.error("Error loading bug hunters:", error);
          document.getElementById("topHuntersGrid").innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; color: #ff4444;">
                        Failed to load bug hunters data. Please try again later.
                    </div>
                `;
          document.getElementById("allHuntersGrid").innerHTML = "";
        }
      });
    </script>
  </body>
</html>
