<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pets - CraftersMC Guides</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/essential.css">
  <link rel="stylesheet" href="css/item.css">
</head>

<body>
  <div id="loader"><div></div><div></div><div></div></div>
  <div class="navbar"></div>
  <div class="sidebar" id="sidebar"></div>
  <div id="sidebar-overlay"></div>
  <button id="scrollToTopBtn"><span class="material-icons">north</span></button>

  <div class="item-container" id="itemDetails">
    <p>Loading pet data...</p>
  </div>

  <div id="footer"></div>

  <script>
    async function loadPetDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const petId = urlParams.get('pet');

      if (!petId) {
        document.getElementById('itemDetails').innerHTML = '<p>No pet ID specified.</p> <a href="index.html">Back to Home</a>';
        return;
      }

      try {
        const res = await fetch('market/pets.txt');
        const raw = await res.text();
        const pets = JSON.parse(raw);
        const pet = pets.find(p => p.id === petId);

        if (!pet) {
          document.getElementById('itemDetails').innerHTML = '<p>Pet not found.</p> <a href="index.html">Back to Home</a>';
          return;
        }

        const rarities = ["common", "uncommon", "rare", "epic", "legendary"];
        const itemDetailsDiv = document.getElementById('itemDetails');

        let buttons = rarities.map((rarity, i) => {
          const available = pet.price.length > i && pet.price[i] > 0;
          return `<button class="rarity-btn" data-index="${i}" ${!available ? 'disabled' : ''}>${capitalize(rarity)}</button>`;
        }).join(' ');

        itemDetailsDiv.innerHTML = `
          <h1>${pet.name}</h1>
          ${pet.picture ? `<img src="${pet.picture}" alt="${pet.name}">` : ''}
          <div class="rarity-buttons">${buttons}</div>
          <p><strong>ID:</strong> ${pet.id}</p>
          <p><strong>Category:</strong> ${pet.category}</p>
          <p><strong>Description:</strong> ${pet.description}</p>
          <div id="priceDisplay"><p><strong>Price:</strong> ${formatPrice(pet.price[0])}</p></div>
        `;

        document.querySelectorAll('.rarity-btn').forEach(btn => {
          btn.addEventListener('click', e => {
            const index = parseInt(e.target.dataset.index);
            document.getElementById('priceDisplay').innerHTML =
              `<p><strong>Price:</strong> ${formatPrice(pet.price[index])}</p>`;
          });
        });

      } catch (err) {
        console.error('Failed to load pets:', err);
        document.getElementById('itemDetails').innerHTML = '<p>Failed to load pet details.</p> <a href="index.html">Back to Home</a>';
      }
    }

    function formatPrice(price) {
      if (!price || isNaN(price)) return `<span class="price">N/A</span>`;
      return `<span class="price">${Number(price).toLocaleString()} <img src="img/coin.png" alt="Coin"></span>`;
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    loadPetDetails();
  </script>

  <script src="js/script.js"></script>
</body>
</html>
