<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Developer Management</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* ... (your same CSS as before) ... */
    .confirm-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex; justify-content: center; align-items: center;
      z-index: 10000;
    }
    .confirm-box {
      background: var(--bg-secondary-color);
      padding: 20px;
      border-radius: 10px;
      width: 350px;
      text-align: center;
    }
    .confirm-box img {
      width: 80px; height: 80px;
      border-radius: 50%; margin-bottom: 10px;
    }
    .confirm-buttons {
      margin-top: 15px; display: flex; justify-content: space-around;
    }
    .confirm-buttons button {
      padding: 8px 16px; border: none; border-radius: 6px;
      cursor: pointer; font-weight: bold;
    }
    .confirm-buttons .confirm {
      background: var(--button-bg-color); color: white;
    }
    .confirm-buttons .abort {
      background: var(--danger-bg-color); color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Developer Management</h1>
    <ul id="devList" class="dev-list">
      <li>Loading...</li>
    </ul>
    <div class="add-section">
      <input type="text" id="newIdInput" placeholder="Enter new Developer ID">
      <button id="addIdBtn" class="add-btn">Add</button>
    </div>
    <button id="saveChangesBtn" class="save-btn">Save Changes</button>
  </div>

  <div id="confirmModal" class="confirm-modal" style="display:none;">
    <div class="confirm-box">
      <div id="confirmContent"></div>
      <div class="confirm-buttons">
        <button class="confirm" id="confirmBtn">Confirm</button>
        <button class="abort" id="abortBtn">Abort</button>
      </div>
    </div>
  </div>

  <script>
    /* === your existing variables, cookies, and save logic unchanged === */

    // keep devIds as before
    let devIds = [];

    // override Add button with confirmation logic
    document.getElementById('addIdBtn').addEventListener('click', async () => {
      const input = document.getElementById('newIdInput');
      const newId = input.value.trim();
      if (!newId) return;

      if (devIds.includes(newId)) {
        showToast('This ID is already in the list.', 'error');
        return;
      }

      try {
        const res = await fetch(`https://discord-auth.roumakdatta.workers.dev/users/${newId}`);
        if (!res.ok) throw new Error("Not found");
        const user = await res.json();

        // build confirmation content
        const xboxName = user.xbox && user.xbox.name ? user.xbox.name : "Not linked";
        document.getElementById('confirmContent').innerHTML = `
          <img src="${user.avatar}" alt="avatar">
          <h3>${user.global_name || user.username}</h3>
          <p>ID: ${user.id}</p>
          <p>Xbox: ${xboxName}</p>
        `;
        document.getElementById('confirmModal').style.display = 'flex';

        // confirm button
        document.getElementById('confirmBtn').onclick = () => {
          devIds.push(newId);
          renderDevList();
          input.value = '';
          document.getElementById('confirmModal').style.display = 'none';
        };
        // abort button
        document.getElementById('abortBtn').onclick = () => {
          document.getElementById('confirmModal').style.display = 'none';
        };

      } catch (e) {
        showToast("User not found in database.", "error");
      }
    });

    // hook sync after any save
    async function triggerSync() {
      try {
        await fetch("https://discord-auth.roumakdatta.workers.dev/sync-devs");
      } catch (e) {
        console.error("Sync failed:", e);
      }
    }

    // wrap your existing Save Changes button
    const oldSaveBtn = document.getElementById('saveChangesBtn');
    oldSaveBtn.addEventListener('click', async () => {
      // your full existing save logic is here unchanged...
      // inside the success block after "Changes saved successfully!"
      await triggerSync();
    });

    /* === rest of your original code unchanged (renderDevList, removeId, showToast, GitHub commit logic) === */
  </script>
</body>
</html>
